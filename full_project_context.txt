
========================================
FILE: docker-compose.yml
========================================
#version: '3.8'

services:
  # --- 1. –°–ï–†–í–Ü–° –¢–û–í–ê–†–Ü–í (Backend) ---
  product_service:
    build: ./product_service
    container_name: pos_product_service
    restart: always
    ports:
      - "8001:8000"
    environment:
      # –ó–≤'—è–∑–æ–∫ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö (postgres_db - —Ü–µ –Ω–∞–∑–≤–∞ —Å–µ—Ä–≤—ñ—Å—É –Ω–∏–∂—á–µ)
      - DATABASE_URL=postgresql://user:password@postgres_db:5432/products_db
    depends_on:
      - postgres_db

  # --- 2. –ë–ê–ó–ê –î–ê–ù–ò–• –¢–û–í–ê–†–Ü–í (PostgreSQL) ---
  postgres_db:
    image: postgres:13
    container_name: pos_postgres
    restart: always
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: products_db
    volumes:
      # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –Ω–∞ –¥–∏—Å–∫—É, —â–æ–± –Ω–µ –∑–Ω–∏–∫–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
      - postgres_data:/var/lib/postgresql/data

  # --- 3. –°–ï–†–í–Ü–° –ö–û–®–ò–ö–ê (Backend) ---
  order_service:
    build: ./order_service
    container_name: pos_order_service
    restart: always
    environment:
      # –ó–≤'—è–∑–æ–∫ –∑ Redis
      - REDIS_HOST=redis_db
    depends_on:
      - redis_db

  # --- 4. –ë–ê–ó–ê –î–ê–ù–ò–• –ö–û–®–ò–ö–ê (Redis) ---
  redis_db:
    image: redis:alpine
    container_name: pos_redis
    restart: always

  # --- 5. –í–•–Ü–î–ù–Ü –í–û–†–û–¢–ê (Nginx) ---
  frontend:  # <-- –ù–û–í–ê –ù–ê–ó–í–ê (–±—É–ª–æ nginx –∞–±–æ gateway)
    build: ./frontend
    container_name: pos_frontend # <-- –ù–û–í–ï –Ü–ú'–Ø –ö–û–ù–¢–ï–ô–ù–ï–†–ê
    restart: always
    ports:
      - "8080:80"
    depends_on:
      - product_service
      - order_service

# –û–≥–æ–ª–æ—à—É—î–º–æ —Ç–æ–º–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
volumes:
  postgres_data:


========================================
FILE: order_service/requirements.txt
========================================
fastapi
uvicorn
redis


========================================
FILE: order_service/main.py
========================================
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
import redis
import os

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

REDIS_HOST = os.getenv("REDIS_HOST", "pos_redis")
REDIS_PORT = int(os.getenv("REDIS_PORT", 6379))

# decode_responses=True –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä–æ–∫–∏
r = redis.Redis(host=REDIS_HOST, port=REDIS_PORT, db=0, decode_responses=True)
CART_KEY = "cart"

@app.get("/")
def read_root():
    return {"message": "Order Service is running!"}

# --- –í–ò–ü–†–ê–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø ---
@app.get("/cart/")
def get_cart():
    raw_cart = r.hgetall(CART_KEY)
    
    # –ú–∏ —Ñ–æ—Ä–º—É—î–º–æ –°–ª–æ–≤–Ω–∏–∫ (Dictionary), –∞ –Ω–µ —Å–ø–∏—Å–æ–∫
    # –ë—É–ª–æ: {"item:9": "2"} -> –°—Ç–∞–Ω–µ: {"9": 2}
    clean_cart = {}
    
    for key, value in raw_cart.items():
        try:
            # key = "item:9" -> parts = ["item", "9"]
            parts = key.split(":")
            if len(parts) == 2 and parts[0] == "item":
                item_id = parts[1] # –ó–∞–ª–∏—à–∞—î–º–æ —è–∫ —Å—Ç—Ä—ñ—á–∫—É "9", –±–æ JSON –∫–ª—é—á—ñ –∑–∞–≤–∂–¥–∏ —Å—Ç—Ä—ñ—á–∫–∏
                quantity = int(value)
                
                clean_cart[item_id] = quantity
        except ValueError:
            continue

    # –†–µ–∑—É–ª—å—Ç–∞—Ç: {"9": 2, "14": 1}
    return clean_cart

@app.post("/cart/{item_id}")
def add_item(item_id: int):
    r.hincrby(CART_KEY, f"item:{item_id}", 1)
    return {"status": "added", "id": item_id}

@app.post("/cart/{item_id}/decrease")
def decrease_item(item_id: int):
    key = f"item:{item_id}"
    new_qty = r.hincrby(CART_KEY, key, -1)
    if new_qty <= 0:
        r.hdel(CART_KEY, key)
    return {"status": "decreased", "id": item_id, "qty": new_qty}

@app.delete("/cart/{item_id}")
def remove_item(item_id: int):
    key = f"item:{item_id}"
    r.hdel(CART_KEY, key)
    return {"status": "removed", "id": item_id}

@app.delete("/cart/")
def clear_cart():
    r.delete(CART_KEY)
    return {"status": "cart cleared"}

========================================
FILE: order_service/Dockerfile
========================================
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY main.py .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]


========================================
FILE: frontend/index.html
========================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HITS-POS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

========================================
FILE: frontend/vite.config.js
========================================
import { fileURLToPath, URL } from 'node:url'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue(),
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  server: {
    host: '0.0.0.0',
    port: 5173,
    proxy: {
      // 1. –ó–∞–ø–∏—Ç–∏ –¥–æ –ö–û–®–ò–ö–ê –π–¥—É—Ç—å –Ω–∞ order_service (8000)
      '/api/cart': {
        target: 'http://order_service:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '') 
      },
      // 2. –í—Å—ñ —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏ (Categories, Units, Products) –π–¥—É—Ç—å –Ω–∞ product_service (8001)
      '/api': {
        target: 'http://product_service:8000', // –í—Å–µ—Ä–µ–¥–∏–Ω—ñ Docker –º–µ—Ä–µ–∂—ñ –≤–æ–Ω–∏ –≤—Å—ñ —Å–ª—É—Ö–∞—é—Ç—å 8000
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})

========================================
FILE: frontend/README.md
========================================
# Vue 3 + Vite

This template should help get you started developing with Vue 3 in Vite. The template uses Vue 3 `<script setup>` SFCs, check out the [script setup docs](https://v3.vuejs.org/api/sfc-script-setup.html#sfc-script-setup) to learn more.

Learn more about IDE Support for Vue in the [Vue Docs Scaling up Guide](https://vuejs.org/guide/scaling-up/tooling.html#ide-support).


========================================
FILE: frontend/package.json
========================================
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.5.24"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@vitejs/plugin-vue": "^6.0.1",
    "autoprefixer": "^10.4.17",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.4"
  }
}


========================================
FILE: frontend/postcss.config.js
========================================
export default {
  plugins: {
    tailwindcss: {}, // –ù—ñ—è–∫–∏—Ö —Å–æ–±–∞—á–æ–∫ @tailwindcss/postcss! –ü—Ä–æ—Å—Ç–æ tailwindcss.
    autoprefixer: {},
  },
}

========================================
FILE: frontend/nginx.conf
========================================
server {
    listen 80;
    server_name localhost;

    # 1. –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–§—Ä–æ–Ω—Ç–µ–Ω–¥)
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html; # –î–ª—è —Ä–æ–±–æ—Ç–∏ Vue Router (—â–æ–± –Ω–µ –±—É–ª–æ 404 –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ)
    }

    # 2. –ü—Ä–æ–∫—Å—ñ –¥–ª—è –ö–û–®–ò–ö–ê (Order Service)
    # –ó–∞–ø–∏—Ç /api/cart/... –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ http://order_service:8000/cart/...
    location /api/cart {
        # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api, –∑–∞–ª–∏—à–∞—î–º–æ /cart
        rewrite ^/api/(.*) /$1 break;
        proxy_pass http://order_service:8000;
        proxy_set_header Host $host;
    }

    # 3. –ü—Ä–æ–∫—Å—ñ –¥–ª—è –¢–û–í–ê–†–Ü–í (Product Service) - –≤—Å–µ —ñ–Ω—à–µ api
    # –ó–∞–ø–∏—Ç /api/units/... –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ http://product_service:8000/units/...
    location /api/ {
        # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api
        rewrite ^/api/(.*) /$1 break;
        proxy_pass http://product_service:8000;
        proxy_set_header Host $host;
    }
}

========================================
FILE: frontend/Dockerfile
========================================
# --- –ï–¢–ê–ü 1: –ó–±—ñ—Ä–∫–∞ (Build) ---
# –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û –í–ï–†–°–Ü–Æ 22, –±–æ Vite 6/7 —Ü—å–æ–≥–æ –≤–∏–º–∞–≥–∞—î
FROM node:22-alpine as build-stage

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN npm run build

# --- –ï–¢–ê–ü 2: –ü—Ä–æ–¥–∞–∫—à–Ω (Nginx) ---
FROM nginx:alpine as production-stage

COPY --from=build-stage /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]

========================================
FILE: frontend/tailwind.config.js
========================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

========================================
FILE: frontend/src/App.vue
========================================
<script setup>
import { ref, onMounted } from 'vue'
import Sidebar from './components/Sidebar.vue'
import ProductCard from './components/ProductCard.vue'
import CartDrawer from './components/CartDrawer.vue'
import Warehouse from './components/Warehouse.vue'

// --- –ó–ú–Ü–ù–ù–Ü –°–¢–ê–ù–£ ---
const currentPage = ref('pos') // 'pos' (–ö–∞—Å–∞) –∞–±–æ 'warehouse' (–°–∫–ª–∞–¥)

// –î–∞–Ω—ñ –¥–ª—è –∫–∞—Å–∏
const products = ref([])
const loading = ref(true)
const error = ref(null)
const cartCount = ref(0)
const isCartOpen = ref(false)

// --- –õ–û–ì–Ü–ö–ê –ö–ê–°–ò (POS) ---

// 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É
const fetchProducts = async () => {
  try {
    // –í–ê–ñ–õ–ò–í–û: –¢—É—Ç –º–∏ –∑–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ api/products (—Ü–µ –π–¥–µ –Ω–∞ product_service)
    // –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —â–µ –Ω–µ –∑—Ä–æ–±–∏–ª–∏ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –≤ –±–∞–∑—ñ, 
    // —Ü–µ–π –∑–∞–ø–∏—Ç –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø—É—Å—Ç–∏–π —Å–ø–∏—Å–æ–∫, –∞–ª–µ –ø–æ–º–∏–ª–∫–∏ –Ω–µ –±—É–¥–µ.
    const res = await fetch('/api/products/') 
    if (res.ok) {
      products.value = await res.json()
    } else {
      // –¢–∏–º—á–∞—Å–æ–≤–∞ –∑–∞–≥–ª—É—à–∫–∞, —è–∫—â–æ –±–∞–∑–∞ –ø—É—Å—Ç–∞
      products.value = [] 
    }
  } catch (err) {
    error.value = "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–Ω—é"
    console.error(err)
  } finally {
    loading.value = false
  }
}

// 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –∫–æ—à–∏–∫–∞
const updateCartCount = async () => {
  try {
    const res = await fetch('/api/cart/')
    const cart = await res.json()
    // –ü–∞—Ä—Å–∏–º–æ –≤ —á–∏—Å–ª–∞, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ "0112"
    cartCount.value = Object.values(cart).reduce((sum, qty) => sum + parseInt(qty), 0)
  } catch (err) {
    console.error(err)
  }
}

// 3. –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤ –∫–æ—à–∏–∫
const addToCart = async (product) => {
  try {
    const res = await fetch(`/api/cart/${product.id}`, { method: 'POST' })
    if (res.ok) {
      await updateCartCount()
    }
  } catch (err) {
    console.error(err)
  }
}

// 4. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–æ—à–∏–∫–∞
const openCart = () => {
  isCartOpen.value = true
}

// –ü—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
onMounted(() => {
  fetchProducts()
  updateCartCount()
})
</script>

<template>
  <div class="flex h-screen bg-gray-50 text-gray-800 font-sans overflow-hidden">
    
    <Sidebar 
      :current-page="currentPage" 
      @change-page="(page) => currentPage = page" 
    />

    <main v-if="currentPage === 'pos'" class="flex-1 ml-64 flex flex-col h-screen relative">
      
      <header class="bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-gray-200 px-8 py-4 flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold text-gray-800">–ú–µ–Ω—é</h2>
          <p class="text-sm text-gray-500">–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä–∏ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
        </div>
        
        <button 
          @click="openCart"
          class="bg-gray-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-800 transition shadow-lg flex items-center gap-3 active:scale-95">
          <i class="fas fa-shopping-cart"></i>
          <span>–ö–æ—à–∏–∫: {{ cartCount }}</span>
        </button>
      </header>

      <div class="p-8 overflow-y-auto flex-1 custom-scrollbar">
        <div v-if="loading" class="flex flex-col items-center justify-center h-64 text-gray-400">
          <i class="fas fa-circle-notch fa-spin text-3xl mb-4"></i>
          <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
        </div>

        <div v-else-if="products.length === 0" class="flex flex-col items-center justify-center h-64 text-gray-400">
          <i class="fas fa-mug-hot text-4xl mb-4 opacity-50"></i>
          <p>–ú–µ–Ω—é –ø–æ–∫–∏ –ø–æ—Ä–æ–∂–Ω—î. –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –Ω–∞ –°–∫–ª–∞–¥—ñ!</p>
        </div>

        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
          <ProductCard 
            v-for="item in products" 
            :key="item.id" 
            :product="item" 
            @add-to-cart="addToCart(item)" 
          />
        </div>
      </div>

      <CartDrawer 
        :is-open="isCartOpen"
        :products="products"
        @close="isCartOpen = false"
        @clear-cart="updateCartCount"
      />
    </main>

    <Warehouse v-if="currentPage === 'warehouse'" />

  </div>
</template>

<style>
.custom-scrollbar::-webkit-scrollbar { width: 6px; }
.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
.custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
</style>

========================================
FILE: frontend/src/style.css
========================================
@tailwind base;
@tailwind components;
@tailwind utilities;


========================================
FILE: frontend/src/main.js
========================================
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'

createApp(App).mount('#app')


========================================
FILE: frontend/src/components/ProductCard.vue
========================================
<script setup>
import { computed } from 'vue'

const props = defineProps({
  product: Object
})

const emit = defineEmits(['add-to-cart'])

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–±–æ—Ä—É —ñ–∫–æ–Ω–∫–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–∞–±–æ –Ω–∞–∑–≤–∏)
const productIcon = computed(() => {
  const name = props.product.name.toLowerCase()
  const cat = props.product.category?.name?.toLowerCase() || ''

  if (name.includes('–∫–∞–≤–∞') || name.includes('–µ—Å–ø—Ä–µ—Å–æ') || cat.includes('–Ω–∞–ø–æ—ó')) return 'fas fa-mug-hot'
  if (name.includes('—á–∞–π')) return 'fas fa-leaf'
  if (name.includes('—Ç–æ—Ä—Ç') || name.includes('–¥–µ—Å–µ—Ä—Ç') || cat.includes('–¥–µ—Å–µ—Ä—Ç–∏')) return 'fas fa-birthday-cake'
  if (name.includes('–∫—Ä—É–∞—Å–∞–Ω')) return 'fas fa-bread-slice'
  
  return 'fas fa-box' // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —ñ–∫–æ–Ω–∫–∞
})

// –ö–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
const cardColor = computed(() => {
  const cat = props.product.category?.slug || ''
  if (cat === 'hot-drinks') return 'bg-orange-50 text-orange-600 border-orange-100'
  if (cat === 'desserts') return 'bg-pink-50 text-pink-600 border-pink-100'
  return 'bg-white text-gray-700 border-gray-100'
})
</script>

<template>
  <div 
    @click="emit('add-to-cart')"
    class="relative group cursor-pointer transition-all duration-200 hover:-translate-y-1 hover:shadow-xl rounded-2xl border overflow-hidden bg-white"
  >
    <div class="h-32 flex items-center justify-center text-5xl transition-transform group-hover:scale-110" 
         :class="cardColor">
      <i :class="productIcon"></i>
    </div>

    <div class="p-4">
      <div v-if="product.category" class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1">
        {{ product.category.name }}
      </div>
      
      <h3 class="font-bold text-lg text-gray-800 leading-tight mb-2">{{ product.name }}</h3>
      
      <div class="flex justify-between items-center mt-3">
        <span class="text-xl font-bold text-gray-900">{{ product.price }} ‚Ç¥</span>
        
        <button class="w-8 h-8 rounded-full bg-gray-900 text-white flex items-center justify-center hover:bg-green-500 transition shadow-lg">
          <i class="fas fa-plus text-xs"></i>
        </button>
      </div>
    </div>
  </div>
</template>

========================================
FILE: frontend/src/components/HelloWorld.vue
========================================
<script setup>
import { ref } from 'vue'

defineProps({
  msg: String,
})

const count = ref(0)
</script>

<template>
  <h1>{{ msg }}</h1>

  <div class="card">
    <button type="button" @click="count++">count is {{ count }}</button>
    <p>
      Edit
      <code>components/HelloWorld.vue</code> to test HMR
    </p>
  </div>

  <p>
    Check out
    <a href="https://vuejs.org/guide/quick-start.html#local" target="_blank"
      >create-vue</a
    >, the official Vue + Vite starter
  </p>
  <p>
    Learn more about IDE Support for Vue in the
    <a
      href="https://vuejs.org/guide/scaling-up/tooling.html#ide-support"
      target="_blank"
      >Vue Docs Scaling up Guide</a
    >.
  </p>
  <p class="read-the-docs">Click on the Vite and Vue logos to learn more</p>
</template>

<style scoped>
.read-the-docs {
  color: #888;
}
</style>


========================================
FILE: frontend/src/components/Warehouse.vue
========================================
<script setup>
import { ref, onMounted } from 'vue'

const activeTab = ref('categories') // 'categories', 'units', 'ingredients', 'products'

// --- –î–ê–ù–Ü ---
const categories = ref([])
const units = ref([])
const ingredients = ref([])
const products = ref([]) // <--- –ù–û–í–ï: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤
const loading = ref(false)

// --- –§–û–†–ú–ò ---
const newCategory = ref({ name: '', slug: '' })
const newUnit = ref({ name: '', symbol: '' })
const newIngredient = ref({ name: '', unit_id: '', cost_per_unit: 0, stock_quantity: 0 })

// <--- –ù–û–í–ï: –§–æ—Ä–º–∞ —Ç–æ–≤–∞—Ä—É –∑ —Ä–µ—Ü–µ–ø—Ç–æ–º
const newProduct = ref({
  name: '',
  price: 0,
  description: '',
  category_id: '',
  recipe: [] // –¢—É—Ç –±—É–¥–µ —Å–ø–∏—Å–æ–∫: [{ ingredient_id: 5, quantity: 0.01 }, ...]
})

// --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• ---
const fetchData = async () => {
  loading.value = true
  try {
    const [catRes, unitRes, ingRes, prodRes] = await Promise.all([
      fetch('/api/categories/'),
      fetch('/api/units/'),
      fetch('/api/ingredients/'),
      fetch('/api/products/') // <--- –ù–û–í–ï
    ])
    
    categories.value = await catRes.json()
    units.value = await unitRes.json()
    ingredients.value = await ingRes.json()
    products.value = await prodRes.json()
  } catch (err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:", err)
  } finally {
    loading.value = false
  }
}

// --- –§–£–ù–ö–¶–Ü–á –°–¢–í–û–†–ï–ù–ù–Ø ---
const createCategory = async () => {
  if (!newCategory.value.name) return
  await fetch('/api/categories/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(newCategory.value)
  })
  newCategory.value = { name: '', slug: '' }
  fetchData()
}

const createUnit = async () => {
  if (!newUnit.value.name) return
  await fetch('/api/units/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(newUnit.value)
  })
  newUnit.value = { name: '', symbol: '' }
  fetchData()
}

const createIngredient = async () => {
  if (!newIngredient.value.name || !newIngredient.value.unit_id) return
  await fetch('/api/ingredients/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(newIngredient.value)
  })
  newIngredient.value = { name: '', unit_id: '', cost_per_unit: 0, stock_quantity: 0 }
  fetchData()
}

// --- –ù–û–í–ï: –õ–û–ì–Ü–ö–ê –¢–û–í–ê–†–Ü–í ---

// 1. –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫ —É —Ä–µ—Ü–µ–ø—Ç (–≤—ñ–∑—É–∞–ª—å–Ω–æ)
const addIngredientRow = () => {
  newProduct.value.recipe.push({ ingredient_id: '', quantity: 0 })
}

// 2. –í–∏–¥–∞–ª–∏—Ç–∏ —Ä—è–¥–æ–∫ –∑ —Ä–µ—Ü–µ–ø—Ç–∞
const removeIngredientRow = (index) => {
  newProduct.value.recipe.splice(index, 1)
}

// 3. –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä
const createProduct = async () => {
  if (!newProduct.value.name || !newProduct.value.category_id) return alert("–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é!")
  
  // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø—É—Å—Ç—ñ —Ä—è–¥–∫–∏ —Ä–µ—Ü–µ–ø—Ç–∞
  const cleanRecipe = newProduct.value.recipe.filter(r => r.ingredient_id && r.quantity > 0)
  
  const payload = { ...newProduct.value, recipe: cleanRecipe }

  const res = await fetch('/api/products/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })

  if (res.ok) {
    // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
    newProduct.value = { name: '', price: 0, description: '', category_id: '', recipe: [] }
    fetchData()
  } else {
    alert("–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É")
  }
}

// 4. –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä (—â–æ–± –ø–æ—á–∏—Å—Ç–∏—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏)
const deleteProduct = async (id) => {
  if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?")) return
  // –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ —â–µ –Ω–µ –∑—Ä–æ–±–∏–ª–∏ DELETE –≤ API product_service –¥–ª—è products, 
  // —Ü–µ –ø–æ–∫–∏ —â–æ –Ω–µ —Å–ø—Ä–∞—Ü—é—î, –∞–ª–µ –ø—ñ–¥–≥–æ—Ç—É—î–º–æ UI.
  // –î–∞–≤–∞–π –ø–æ–∫–∏ –≤–∏–¥–∞–ª—è—Ç–∏–º–µ–º–æ —á–µ—Ä–µ–∑ –±–∞–∑—É, –∞ —Ç—É—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∞.
  alert("–§—É–Ω–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∫–æ—Ä–æ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞!")
}

onMounted(() => {
  fetchData()
})
</script>

<template>
  <div class="p-8 h-screen overflow-y-auto bg-gray-50 ml-64 custom-scrollbar">
    
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-bold text-gray-800">üì¶ –°–∫–ª–∞–¥—Å—å–∫–∏–π –æ–±–ª—ñ–∫</h2>
        <p class="text-gray-500">–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏, —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ —Ç–∞ —Å–∏—Ä–æ–≤–∏–Ω–æ—é</p>
      </div>
      <button @click="fetchData" class="text-blue-600 hover:bg-blue-50 p-2 rounded-full transition">
        <i class="fas fa-sync-alt" :class="{'fa-spin': loading}"></i>
      </button>
    </div>

    <div class="flex space-x-1 bg-gray-200 p-1 rounded-xl w-fit mb-8 overflow-x-auto">
      <button @click="activeTab = 'categories'" :class="activeTab === 'categories' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'" class="px-6 py-2 rounded-lg font-bold transition-all">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
      <button @click="activeTab = 'units'" :class="activeTab === 'units' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'" class="px-6 py-2 rounded-lg font-bold transition-all whitespace-nowrap">–û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º.</button>
      <button @click="activeTab = 'ingredients'" :class="activeTab === 'ingredients' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'" class="px-6 py-2 rounded-lg font-bold transition-all">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</button>
      <button @click="activeTab = 'products'" :class="activeTab === 'products' ? 'bg-white text-purple-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'" class="px-6 py-2 rounded-lg font-bold transition-all">–¢–æ–≤–∞—Ä–∏ —Ç–∞ –†–µ—Ü–µ–ø—Ç–∏</button>
    </div>

    <div v-if="activeTab === 'categories'" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
        <h3 class="font-bold mb-4 text-gray-700">–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</h3>
        <ul>
          <li v-for="c in categories" :key="c.id" class="flex justify-between border-b py-3">
            <span>{{ c.name }}</span>
            <span class="bg-gray-100 text-xs px-2 py-1 rounded text-gray-500">{{ c.slug }}</span>
          </li>
        </ul>
      </div>
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit">
        <h3 class="font-bold mb-4">–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è</h3>
        <input v-model="newCategory.name" class="w-full border p-2 rounded mb-2" placeholder="–ù–∞–∑–≤–∞">
        <input v-model="newCategory.slug" class="w-full border p-2 rounded mb-4" placeholder="Slug">
        <button @click="createCategory" class="w-full bg-blue-600 text-white py-2 rounded font-bold">–î–æ–¥–∞—Ç–∏</button>
      </div>
    </div>

    <div v-if="activeTab === 'units'" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
         <h3 class="font-bold mb-4 text-gray-700">–û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—É</h3>
         <ul>
          <li v-for="u in units" :key="u.id" class="flex justify-between border-b py-3">
            <span>{{ u.name }}</span>
            <span class="font-bold text-green-600">{{ u.symbol }}</span>
          </li>
        </ul>
      </div>
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit">
        <h3 class="font-bold mb-4">–ù–æ–≤–∞ –æ–¥–∏–Ω–∏—Ü—è</h3>
        <input v-model="newUnit.name" class="w-full border p-2 rounded mb-2" placeholder="–ù–∞–∑–≤–∞">
        <input v-model="newUnit.symbol" class="w-full border p-2 rounded mb-4" placeholder="–°–∏–º–≤–æ–ª">
        <button @click="createUnit" class="w-full bg-blue-600 text-white py-2 rounded font-bold">–î–æ–¥–∞—Ç–∏</button>
      </div>
    </div>

    <div v-if="activeTab === 'ingredients'" class="grid grid-cols-1 xl:grid-cols-3 gap-8">
      <div class="xl:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr><th class="p-4">–ù–∞–∑–≤–∞</th><th class="p-4 text-right">–¶—ñ–Ω–∞/–æ–¥</th><th class="p-4 text-right">–ó–∞–ª–∏—à–æ–∫</th></tr>
          </thead>
          <tbody>
            <tr v-for="i in ingredients" :key="i.id" class="border-b hover:bg-gray-50">
              <td class="p-4">{{ i.name }}</td>
              <td class="p-4 text-right">{{ i.cost_per_unit }} ‚Ç¥</td>
              <td class="p-4 text-right font-bold" :class="i.stock_quantity > 0 ? 'text-green-600':'text-red-500'">
                {{ i.stock_quantity }} {{ i.unit?.symbol }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit">
        <h3 class="font-bold mb-4">–ù–æ–≤–∏–π —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</h3>
        <input v-model="newIngredient.name" class="w-full border p-2 rounded mb-2" placeholder="–ù–∞–∑–≤–∞">
        <select v-model="newIngredient.unit_id" class="w-full border p-2 rounded mb-2 bg-white">
          <option value="" disabled>–û–¥–∏–Ω–∏—Ü—è...</option>
          <option v-for="u in units" :key="u.id" :value="u.id">{{ u.name }}</option>
        </select>
        <div class="grid grid-cols-2 gap-2 mb-4">
          <input v-model="newIngredient.cost_per_unit" type="number" placeholder="–¶—ñ–Ω–∞" class="border p-2 rounded">
          <input v-model="newIngredient.stock_quantity" type="number" placeholder="–ó–∞–ª–∏—à–æ–∫" class="border p-2 rounded">
        </div>
        <button @click="createIngredient" class="w-full bg-orange-500 text-white py-2 rounded font-bold">–î–æ–¥–∞—Ç–∏</button>
      </div>
    </div>

    <div v-if="activeTab === 'products'" class="grid grid-cols-1 xl:grid-cols-3 gap-8 animate-fade-in">
      
      <div class="xl:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr>
              <th class="p-4">–ù–∞–∑–≤–∞</th>
              <th class="p-4">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
              <th class="p-4 text-right">–¶—ñ–Ω–∞</th>
              <th class="p-4 text-center">–î—ñ—ó</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="p in products" :key="p.id" class="border-b hover:bg-gray-50">
              <td class="p-4 font-bold">{{ p.name }}</td>
              <td class="p-4 text-sm text-gray-500">
                {{ p.category ? p.category.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó' }}
              </td>
              <td class="p-4 text-right font-mono">{{ p.price }} ‚Ç¥</td>
              <td class="p-4 text-center">
                <button @click="deleteProduct(p.id)" class="text-red-400 hover:text-red-600 transition">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-sm border border-purple-100 h-fit border-2">
        <h3 class="text-lg font-bold mb-4 text-purple-700 flex items-center gap-2">
          <i class="fas fa-magic"></i> –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–æ–≤–∞—Ä
        </h3>
        
        <div class="space-y-3">
          <div>
            <label class="text-xs font-bold text-gray-400 uppercase">–ù–∞–∑–≤–∞</label>
            <input v-model="newProduct.name" type="text" placeholder="–ù–∞–ø—Ä: –õ–∞—Ç–µ XL" class="w-full border p-2 rounded mt-1">
          </div>
          
          <div class="grid grid-cols-2 gap-3">
             <div>
                <label class="text-xs font-bold text-gray-400 uppercase">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                <select v-model="newProduct.category_id" class="w-full border p-2 rounded mt-1 bg-white">
                  <option v-for="c in categories" :key="c.id" :value="c.id">{{ c.name }}</option>
                </select>
             </div>
             <div>
                <label class="text-xs font-bold text-gray-400 uppercase">–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É</label>
                <input v-model="newProduct.price" type="number" class="w-full border p-2 rounded mt-1 text-right">
             </div>
          </div>

          <div class="pt-4 border-t border-dashed">
            <label class="text-xs font-bold text-purple-600 uppercase mb-2 block">–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∞ –∫–∞—Ä—Ç–∞ (–†–µ—Ü–µ–ø—Ç)</label>
            
            <div v-for="(row, index) in newProduct.recipe" :key="index" class="flex gap-2 mb-2 items-center">
              <select v-model="row.ingredient_id" class="flex-1 border p-2 rounded bg-gray-50 text-sm">
                <option value="" disabled>–°–∏—Ä–æ–≤–∏–Ω–∞...</option>
                <option v-for="ing in ingredients" :key="ing.id" :value="ing.id">
                  {{ ing.name }}
                </option>
              </select>
              
              <input v-model="row.quantity" type="number" step="0.001" placeholder="–ö—ñ–ª-—Ç—å" class="w-20 border p-2 rounded text-sm text-right">
              
              <button @click="removeIngredientRow(index)" class="text-red-400 hover:text-red-600 px-1">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <button @click="addIngredientRow" class="text-sm text-purple-600 font-bold hover:underline mt-1">
              + –î–æ–¥–∞—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç
            </button>
          </div>

          <button @click="createProduct" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold hover:bg-purple-700 transition mt-4 shadow-lg shadow-purple-200">
            –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–æ–≤–∞—Ä
          </button>
        </div>
      </div>

    </div>

  </div>
</template>

========================================
FILE: frontend/src/components/Sidebar.vue
========================================
<script setup>
// –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∞–∫—Ç–∏–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—ñ–¥ –±–∞—Ç—å–∫–∞
defineProps({
  currentPage: String 
})

const emit = defineEmits(['change-page'])
</script>

<template>
  <aside class="w-64 bg-gray-900 text-white flex flex-col h-screen fixed left-0 top-0 border-r border-gray-800 z-50">
    
    <div class="p-6 text-2xl font-bold text-center border-b border-gray-800 flex items-center justify-center gap-2">
      <div class="w-8 h-8 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full"></div>
      HITS POS
    </div>

    <nav class="flex-1 py-6 space-y-1">
      
      <a href="#" 
         @click.prevent="emit('change-page', 'pos')"
         :class="currentPage === 'pos' ? 'bg-gray-800 text-yellow-400 border-l-4 border-yellow-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all">
        <i class="fas fa-cash-register w-6 text-center mr-2"></i> 
        –ö–∞—Å–∞
      </a>
      
      <a href="#" 
         @click.prevent="emit('change-page', 'warehouse')"
         :class="currentPage === 'warehouse' ? 'bg-gray-800 text-blue-400 border-l-4 border-blue-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all group">
        <i class="fas fa-boxes w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 
        –°–∫–ª–∞–¥
      </a>
      
      <a href="#" class="flex items-center px-6 py-3 text-gray-400 hover:bg-gray-800 hover:text-white transition-all group">
        <i class="fas fa-chart-line w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      </a>
    </nav>

    <div class="p-4 border-t border-gray-800 text-xs text-gray-500 text-center">
      <p>Server: <span class="text-green-500">Online üü¢</span></p>
    </div>
  </aside>
</template>

========================================
FILE: frontend/src/components/CartDrawer.vue
========================================
<script setup>
import { computed, ref, watch } from 'vue'

const props = defineProps({
  isOpen: Boolean,
  products: Array // –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö —Ç–æ–≤–∞—Ä—ñ–≤
})

const emit = defineEmits(['close', 'clear-cart'])
const cartItems = ref([])
const isProcessing = ref(false)
const paymentMethod = ref('cash') // 'cash' –∞–±–æ 'card'

// --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –î–ê–ù–ò–• ---
const loadCart = async () => {
  try {
    const res = await fetch('/api/cart/')
    if (!res.ok) return
    
    // –û—Ç—Ä–∏–º—É—î–º–æ: {"9": 2, "14": 1}
    const rawCart = await res.json() 
    
    const items = []
    // –ü—Ä–æ—Ö–æ–¥–∏–º–æ –ø–æ —Å–ª–æ–≤–Ω–∏–∫—É (Object.entries —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –Ω–æ–≤–æ–≥–æ main.py)
    for (const [idStr, qty] of Object.entries(rawCart)) {
      const id = parseInt(idStr)
      const product = props.products.find(p => p.id === id)
      
      if (product) {
        items.push({
          product_id: id,
          name: product.name,
          price: product.price,
          quantity: parseInt(qty),
          // –î–æ–¥–∞—î–º–æ –∫–∞—Ä—Ç–∏–Ω–∫—É, —è–∫—â–æ —î, –∞–±–æ –∑–∞–≥–ª—É—à–∫—É
          image: product.image || null 
        })
      }
    }
    // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –Ω–∞–∑–≤–æ—é, —â–æ–± –Ω–µ —Å—Ç—Ä–∏–±–∞–ª–∏
    cartItems.value = items.sort((a, b) => a.name.localeCompare(b.name))
  } catch (err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –∫–æ—à–∏–∫–∞:", err)
  }
}

// --- –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –¢–û–í–ê–†–ê–ú–ò ---

// –ó–±—ñ–ª—å—à–∏—Ç–∏ (+1)
const increaseQty = async (id) => {
  await fetch(`/api/cart/${id}`, { method: 'POST' })
  await loadCart() // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫
}

// –ó–º–µ–Ω—à–∏—Ç–∏ (-1)
const decreaseQty = async (id) => {
  await fetch(`/api/cart/${id}/decrease`, { method: 'POST' })
  await loadCart()
}

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é
const removeItem = async (id) => {
  if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä –∑ –∫–æ—à–∏–∫–∞?')) return
  await fetch(`/api/cart/${id}`, { method: 'DELETE' })
  await loadCart()
}

// –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ
const clearAll = async () => {
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –∫–æ—à–∏–∫?')) return
  await fetch('/api/cart/', { method: 'DELETE' })
  await loadCart()
  emit('clear-cart') // –°–∏–≥–Ω–∞–ª –±–∞—Ç—å–∫—É –æ–Ω–æ–≤–∏—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫
}

// --- –û–ü–õ–ê–¢–ê ---
const totalSum = computed(() => {
  return cartItems.value.reduce((sum, item) => sum + (item.price * item.quantity), 0)
})

const checkout = async () => {
  if (cartItems.value.length === 0) return
  isProcessing.value = true

  try {
    const payload = {
      items: cartItems.value.map(item => ({
        product_id: item.product_id,
        quantity: item.quantity
      })),
      payment_method: paymentMethod.value, // –ü–µ—Ä–µ–¥–∞—î–º–æ —Ç–∏–ø –æ–ø–ª–∞—Ç–∏
      total_price: totalSum.value
    }

    // –°–ø–∏—Å–∞–Ω–Ω—è —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤
    const deductRes = await fetch('/api/orders/checkout/', { 
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })

    if (!deductRes.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ —Å–ø–∏—Å–∞–Ω–Ω—è –∑—ñ —Å–∫–ª–∞–¥—É")

    // –û—á–∏—Å—Ç–∫–∞ –∫–æ—à–∏–∫–∞ –ø—ñ—Å–ª—è —É—Å–ø—ñ—Ö—É
    await fetch('/api/cart/', { method: 'DELETE' })
    
    alert(`‚úÖ –û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞!\n–°—É–º–∞: ${totalSum.value} ‚Ç¥\n–°–ø–æ—Å—ñ–±: ${paymentMethod.value === 'cash' ? '–ì–æ—Ç—ñ–≤–∫–∞' : '–ö–∞—Ä—Ç–∫–∞'}`)
    
    emit('clear-cart')
    emit('close')
    
  } catch (err) {
    alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç—ñ! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞–ª–∏—à–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥—ñ.")
    console.error(err)
  } finally {
    isProcessing.value = false
  }
}

// –°–ª—ñ–¥–∫—É—î–º–æ –∑–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è–º
watch(() => props.isOpen, (newVal) => {
  if (newVal) loadCart()
})
</script>

<template>
  <div class="fixed inset-0 z-50 flex justify-end transition-opacity duration-300" 
       :class="isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'">
    
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="emit('close')"></div>

    <div class="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col transition-transform duration-300 transform"
         :class="isOpen ? 'translate-x-0' : 'translate-x-full'">
      
      <div class="p-5 bg-gray-900 text-white flex justify-between items-center shadow-md">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <i class="fas fa-shopping-cart"></i> –ö–æ—à–∏–∫
        </h2>
        <div class="flex gap-3">
            <button @click="clearAll" class="text-gray-400 hover:text-red-400 transition" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ">
                <i class="fas fa-trash-alt"></i>
            </button>
            <button @click="emit('close')" class="text-gray-400 hover:text-white transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto p-4 bg-gray-50">
        <div v-if="cartItems.length === 0" class="flex flex-col items-center justify-center h-full text-gray-400">
          <i class="fas fa-shopping-basket text-6xl mb-4 opacity-20"></i>
          <p>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
        </div>

        <div v-else class="space-y-3">
          <div v-for="item in cartItems" :key="item.product_id" 
               class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3">
            
            <div class="flex justify-between items-start">
              <span class="font-bold text-gray-800 text-lg">{{ item.name }}</span>
              <span class="font-mono font-bold text-gray-900">{{ item.price * item.quantity }} ‚Ç¥</span>
            </div>

            <div class="flex justify-between items-center bg-gray-50 rounded-lg p-1">
                <div class="flex items-center gap-3">
                    <button @click="decreaseQty(item.product_id)" 
                            class="w-8 h-8 rounded-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-100 flex items-center justify-center font-bold shadow-sm active:scale-95">
                        -
                    </button>
                    <span class="w-6 text-center font-bold text-gray-800">{{ item.quantity }}</span>
                    <button @click="increaseQty(item.product_id)" 
                            class="w-8 h-8 rounded-full bg-gray-800 text-white hover:bg-gray-700 flex items-center justify-center font-bold shadow-sm active:scale-95">
                        +
                    </button>
                </div>
                
                <button @click="removeItem(item.product_id)" class="text-red-400 hover:text-red-600 p-2">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
          </div>
        </div>
      </div>

      <div class="p-6 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
        
        <div class="mb-4">
            <label class="block text-sm font-bold text-gray-600 mb-2">–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:</label>
            <div class="grid grid-cols-2 gap-3">
                <button @click="paymentMethod = 'cash'"
                    class="py-2 px-4 rounded-lg border-2 flex items-center justify-center gap-2 transition-all"
                    :class="paymentMethod === 'cash' ? 'border-green-500 bg-green-50 text-green-700 font-bold' : 'border-gray-200 text-gray-500 hover:border-gray-300'">
                    <i class="fas fa-money-bill-wave"></i> –ì–æ—Ç—ñ–≤–∫–∞
                </button>
                <button @click="paymentMethod = 'card'"
                    class="py-2 px-4 rounded-lg border-2 flex items-center justify-center gap-2 transition-all"
                    :class="paymentMethod === 'card' ? 'border-blue-500 bg-blue-50 text-blue-700 font-bold' : 'border-gray-200 text-gray-500 hover:border-gray-300'">
                    <i class="fas fa-credit-card"></i> –ö–∞—Ä—Ç–∫–∞
                </button>
            </div>
        </div>

        <div class="flex justify-between items-center text-2xl font-bold mb-4 text-gray-800">
          <span>–†–∞–∑–æ–º:</span>
          <span>{{ totalSum }} ‚Ç¥</span>
        </div>
        
        <button 
          @click="checkout"
          :disabled="cartItems.length === 0 || isProcessing"
          class="w-full py-4 rounded-xl font-bold text-lg text-white transition shadow-lg flex justify-center items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-95"
          :class="paymentMethod === 'cash' ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'">
          
          <span v-if="isProcessing"><i class="fas fa-spinner fa-spin"></i> –û–±—Ä–æ–±–∫–∞...</span>
          <span v-else>
            –û–ø–ª–∞—Ç–∏—Ç–∏ ({{ paymentMethod === 'cash' ? '–ì–æ—Ç—ñ–≤–∫–∞' : '–ö–∞—Ä—Ç–∫–∞' }})
          </span>
        </button>
      </div>
    </div>
  </div>
</template>

========================================
FILE: nginx/nginx.conf
========================================
events {}

http {
    include       /etc/nginx/mime.types; # –í–∞–∂–ª–∏–≤–æ –¥–ª—è —Å—Ç–∏–ª—ñ–≤ CSS —Ç–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        # 1. –§–†–û–ù–¢–ï–ù–î (Vue)
        location / {
            root /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ /index.html;
        }

        # 2. API –ö–û–®–ò–ö–ê (Order Service)
        # –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ /api/cart/...
        location /api/cart/ {
            # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api/cart/ —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –∑–∞–ª–∏—à–æ–∫ –Ω–∞ –±–µ–∫–µ–Ω–¥
            # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: /api/cart/ -> http://order_service:8000/cart/
            proxy_pass http://order_service:8000/cart/;
        }

        # 3. –í–°–Ü –Ü–ù–®–Ü API (Product Service)
        # –¶–µ "catch-all" –±–ª–æ–∫. –°—é–¥–∏ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç—å:
        # /api/products/, /api/categories/, /api/inventory/, /api/ingredients/
        location /api/ {
            # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –∫–æ—Ä—ñ–Ω—å
            # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: /api/inventory/deduct/ -> http://product_service:8000/inventory/deduct/
            rewrite ^/api/(.*) /$1 break;
            proxy_pass http://product_service:8000;
        }
    }
}

========================================
FILE: product_service/requirements.txt
========================================
fastapi
uvicorn
sqlalchemy
psycopg2-binary
pydantic


========================================
FILE: product_service/schemas.py
========================================
from pydantic import BaseModel
from typing import List, Optional 
from datetime import datetime

# --- CATEGORIES ---
class CategoryBase(BaseModel):
    name: str
    slug: str

class CategoryCreate(CategoryBase):
    pass

class Category(CategoryBase):
    id: int
    class Config:
        from_attributes = True

# --- UNITS ---
class UnitBase(BaseModel):
    name: str
    symbol: str

class UnitCreate(UnitBase):
    pass

class Unit(UnitBase):
    id: int
    class Config:
        from_attributes = True

# --- INGREDIENTS ---
class IngredientBase(BaseModel):
    name: str
    unit_id: int
    cost_per_unit: float = 0.0
    stock_quantity: float = 0.0

class IngredientCreate(IngredientBase):
    pass

class Ingredient(IngredientBase):
    id: int
    unit: Unit
    class Config:
        from_attributes = True

# --- RECIPE ITEM ---
class RecipeItemBase(BaseModel):
    ingredient_id: int
    quantity: float

class RecipeItemCreate(RecipeItemBase):
    pass

class RecipeItem(RecipeItemBase):
    id: int
    ingredient_name: Optional[str] = None
    class Config:
        from_attributes = True

# --- PRODUCTS (–¢—É—Ç –±—É–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞) ---
class ProductBase(BaseModel):
    name: str
    price: float
    description: Optional[str] = None
    
    # –ë–£–õ–û: category_id: int
    # –°–¢–ê–õ–û (–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ):
    category_id: Optional[int] = None 

class ProductCreate(ProductBase):
    recipe: List[RecipeItemCreate] = []

class Product(ProductBase):
    id: int
    category: Optional[Category] = None
    recipe: List[RecipeItem] = []

    class Config:
        from_attributes = True

# --- –°–ü–ò–°–ê–ù–ù–Ø ---
# --- –ó–ê–ú–û–í–õ–ï–ù–ù–Ø –¢–ê –°–ü–ò–°–ê–ù–ù–Ø (–û–ù–û–í–õ–ï–ù–û) ---
class SoldItem(BaseModel):
    product_id: int
    quantity: int

# –¶–µ —Ç–µ, —â–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ –§—Ä–æ–Ω—Ç–µ–Ω–¥—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–û–ø–ª–∞—Ç–∏—Ç–∏"
class OrderCreate(BaseModel):
    items: List[SoldItem]
    payment_method: str # "cash" –∞–±–æ "card"
    total_price: float

# –¶–µ —Ç–µ, —è–∫ –º–∏ –±—É–¥–µ–º–æ –≤—ñ–¥–¥–∞–≤–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
class OrderItemRead(BaseModel):
    product_name: str
    quantity: int
    price_at_moment: float
    class Config:
        from_attributes = True

class OrderRead(BaseModel):
    id: int
    created_at: datetime
    total_price: float
    payment_method: str
    items: List[OrderItemRead] = []
    class Config:
        from_attributes = True

#class DeductRequest(BaseModel):
#    items: List[SoldItem]


========================================
FILE: product_service/database.py
========================================
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os

# –§–æ—Ä–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è: postgresql://user:password@hostname/dbname
# –¶—ñ –∑–º—ñ–Ω–Ω—ñ –º–∏ –ø—Ä–æ–ø–∏—Å–∞–ª–∏ –≤ docker-compose.yml —â–µ –Ω–∞ –ø–æ—á–∞—Ç–∫—É
USER = os.getenv("POSTGRES_USER", "user")
PASSWORD = os.getenv("POSTGRES_PASSWORD", "password")
DB_NAME = os.getenv("POSTGRES_DB", "products_db")
HOST = "pos_postgres" # –Ü–º'—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ –ë–î

SQLALCHEMY_DATABASE_URL = f"postgresql://{USER}:{PASSWORD}@{HOST}/{DB_NAME}"

# –°—Ç–≤–æ—Ä—é—î–º–æ –¥–≤–∏–≥—É–Ω (engine)
engine = create_engine(SQLALCHEMY_DATABASE_URL)

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—ñ–π (—á–µ—Ä–µ–∑ –Ω–µ—ó –º–∏ –±—É–¥–µ–º–æ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# –ë–∞–∑–æ–≤–∏–π –∫–ª–∞—Å –¥–ª—è –≤—Å—ñ—Ö –Ω–∞—à–∏—Ö –º–∞–π–±—É—Ç–Ω—ñ—Ö —Ç–∞–±–ª–∏—Ü—å
Base = declarative_base()

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Å—ñ—ó (Dependency Injection)
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

========================================
FILE: product_service/main.py
========================================
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List

# –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –Ω–∞—à—ñ —Ñ–∞–π–ª–∏
import models, schemas, database

app = FastAPI()

# 1. –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—ñ –≤ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (—è–∫—â–æ —ó—Ö –Ω–µ–º–∞—î)
models.Base.metadata.create_all(bind=database.engine)

# --- ENDPOINTS –î–õ–Ø –ö–ê–¢–ï–ì–û–†–Ü–ô ---

# –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
@app.post("/categories/", response_model=schemas.Category)
def create_category(category: schemas.CategoryCreate, db: Session = Depends(database.get_db)):
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —Ç–∞–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
    db_category = db.query(models.Category).filter(models.Category.name == category.name).first()
    if db_category:
        raise HTTPException(status_code=400, detail="Category already exists")
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É
    new_category = models.Category(name=category.name, slug=category.slug)
    db.add(new_category)
    db.commit()
    db.refresh(new_category)
    return new_category

# –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
@app.get("/categories/", response_model=List[schemas.Category])
def read_categories(skip: int = 0, limit: int = 100, db: Session = Depends(database.get_db)):
    categories = db.query(models.Category).offset(skip).limit(limit).all()
    return categories

# ... (—ñ–º–ø–æ—Ä—Ç–∏ —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –∑–≤–µ—Ä—Ö—É) ...

# --- –û–î–ò–ù–ò–¶–Ü –í–ò–ú–Ü–†–£ ---

@app.post("/units/", response_model=schemas.Unit)
def create_unit(unit: schemas.UnitCreate, db: Session = Depends(database.get_db)):
    db_unit = models.Unit(name=unit.name, symbol=unit.symbol)
    db.add(db_unit)
    db.commit()
    db.refresh(db_unit)
    return db_unit

@app.get("/units/", response_model=List[schemas.Unit])
def read_units(db: Session = Depends(database.get_db)):
    return db.query(models.Unit).all()

# --- –Ü–ù–ì–†–ï–î–Ü–Ñ–ù–¢–ò ---

@app.post("/ingredients/", response_model=schemas.Ingredient)
def create_ingredient(ingredient: schemas.IngredientCreate, db: Session = Depends(database.get_db)):
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç
    exists = db.query(models.Ingredient).filter(models.Ingredient.name == ingredient.name).first()
    if exists:
        raise HTTPException(status_code=400, detail="Ingredient already exists")

    new_item = models.Ingredient(
        name=ingredient.name,
        unit_id=ingredient.unit_id,
        cost_per_unit=ingredient.cost_per_unit,
        stock_quantity=ingredient.stock_quantity
    )
    db.add(new_item)
    db.commit()
    db.refresh(new_item)
    return new_item

@app.get("/ingredients/", response_model=List[schemas.Ingredient])
def read_ingredients(db: Session = Depends(database.get_db)):
    return db.query(models.Ingredient).all()

# --- –¢–û–í–ê–†–ò (PRODUCTS) ---

@app.post("/products/", response_model=schemas.Product)
def create_product(product: schemas.ProductCreate, db: Session = Depends(database.get_db)):
    # 1. –°—Ç–≤–æ—Ä—é—î–º–æ —Å–∞–º —Ç–æ–≤–∞—Ä
    db_product = models.Product(
        name=product.name,
        price=product.price,
        description=product.description,
        category_id=product.category_id
    )
    db.add(db_product)
    db.commit()
    db.refresh(db_product) # –û—Ç—Ä–∏–º—É—î–º–æ ID –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä—É

    # 2. –î–æ–¥–∞—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —Ä–µ—Ü–µ–ø—Ç–∞
    for item in product.recipe:
        db_recipe_item = models.ProductIngredient(
            product_id=db_product.id,
            ingredient_id=item.ingredient_id,
            quantity=item.quantity
        )
        db.add(db_recipe_item)
    
    db.commit()
    db.refresh(db_product)
    return db_product

@app.get("/products/", response_model=List[schemas.Product])
def read_products(db: Session = Depends(database.get_db)):
    products = db.query(models.Product).all()
    
    # –ë–ï–ó–ü–ï–ß–ù–ò–ô –¶–ò–ö–õ
    for p in products:
        # –Ø–∫—â–æ —É —Ç–æ–≤–∞—Ä–∞ —î —Ä–µ—Ü–µ–ø—Ç
        if p.recipe:
            for r in p.recipe:
                # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç (—â–æ–± –Ω–µ –≤–ø–∞–ª–æ, —è–∫—â–æ –π–æ–≥–æ –≤–∏–¥–∞–ª–∏–ª–∏)
                if r.ingredient:
                    r.ingredient_name = r.ingredient.name
                else:
                    r.ingredient_name = "–í–∏–¥–∞–ª–µ–Ω–æ"
            
    return products

# --- –û–ë–†–û–ë–ö–ê –ó–ê–ú–û–í–õ–ï–ù–ù–Ø (–ù–û–í–ï) ---
@app.post("/orders/checkout/") # <--- –ó–º—ñ–Ω–∏–ª–∏ URL, —â–æ–± –±—É–ª–æ –ª–æ–≥—ñ—á–Ω–æ
def create_order(order_data: schemas.OrderCreate, db: Session = Depends(database.get_db)):
    """
    1. –°—Ç–≤–æ—Ä—é—î –∑–∞–ø–∏—Å –ø—Ä–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (Order).
    2. –î–æ–¥–∞—î —Ç–æ–≤–∞—Ä–∏ –≤ —ñ—Å—Ç–æ—Ä—ñ—é (OrderItem).
    3. –°–ø–∏—Å—É—î —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑—ñ —Å–∫–ª–∞–¥—É.
    """
    
    # 1. –°—Ç–≤–æ—Ä—é—î–º–æ —á–µ–∫ (Order)
    new_order = models.Order(
        total_price=order_data.total_price,
        payment_method=order_data.payment_method
        # created_at –¥–æ–¥–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
    )
    db.add(new_order)
    db.commit()      # –ö–æ–º—ñ—Ç–∏–º–æ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
    db.refresh(new_order)

    # 2. –ü—Ä–æ—Ö–æ–¥–∏–º–æ –ø–æ –∫–æ–∂–Ω–æ–º—É –∫—É–ø–ª–µ–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É
    for item in order_data.items:
        # –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ç–æ–≤–∞—Ä –≤ –±–∞–∑—ñ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –π–æ–≥–æ –Ω–∞–∑–≤—É —ñ —Ä–µ—Ü–µ–ø—Ç
        product = db.query(models.Product).filter(models.Product.id == item.product_id).first()
        
        if not product:
            continue # –Ø–∫—â–æ —Ç–æ–≤–∞—Ä–∞ –≤–∂–µ –Ω–µ —ñ—Å–Ω—É—î, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ (—Ö–æ—á–∞ —Ü–µ –¥–∏–≤–Ω–æ)

        # –ê. –î–æ–¥–∞—î–º–æ –∑–∞–ø–∏—Å –≤ —ñ—Å—Ç–æ—Ä—ñ—é (OrderItem)
        order_item = models.OrderItem(
            order_id=new_order.id,
            product_name=product.name,
            quantity=item.quantity,
            price_at_moment=product.price
        )
        db.add(order_item)

        # –ë. –°–ø–∏—Å—É—î–º–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ (–°—Ç–∞—Ä–∞ –ª–æ–≥—ñ–∫–∞)
        for recipe_item in product.recipe:
            ingredient = recipe_item.ingredient
            if ingredient:
                amount_to_deduct = recipe_item.quantity * item.quantity
                ingredient.stock_quantity -= amount_to_deduct
                db.add(ingredient)

    # 3. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –∑–º—ñ–Ω–∏ (–Ü—Å—Ç–æ—Ä—ñ—é + –°–ø–∏—Å–∞–Ω–Ω—è)
    db.commit()
    
    return {"message": "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ", "order_id": new_order.id}

# --- –û–¢–†–ò–ú–ê–¢–ò –Ü–°–¢–û–†–Ü–Æ –ó–ê–ú–û–í–õ–ï–ù–¨ ---
@app.get("/orders/", response_model=List[schemas.OrderRead])
def get_orders(skip: int = 0, limit: int = 50, db: Session = Depends(database.get_db)):
    # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —Å–æ—Ä—Ç—É—é—á–∏ –≤—ñ–¥ –Ω–æ–≤–∏—Ö –¥–æ —Å—Ç–∞—Ä–∏—Ö
    orders = db.query(models.Order).order_by(models.Order.created_at.desc()).offset(skip).limit(limit).all()
    return orders

========================================
FILE: product_service/models.py
========================================
from sqlalchemy import Column, Integer, String, Float, ForeignKey, DateTime
from sqlalchemy.orm import relationship
from database import Base
from datetime import datetime

# --- –ö–ê–¢–ï–ì–û–†–Ü–á ---
class Category(Base):
    __tablename__ = "categories"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, unique=True, index=True)
    slug = Column(String, unique=True)

# --- –û–î–ò–ù–ò–¶–Ü –í–ò–ú–Ü–†–£ (–ù–æ–≤–µ) ---
class Unit(Base):
    __tablename__ = "units"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, unique=True)   # "–ö—ñ–ª–æ–≥—Ä–∞–º"
    symbol = Column(String, unique=True) # "–∫–≥"

# --- –Ü–ù–ì–†–ï–î–Ü–Ñ–ù–¢–ò (–ù–æ–≤–µ) ---
class Ingredient(Base):
    __tablename__ = "ingredients"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True, unique=True) # "–ú–æ–ª–æ–∫–æ", "–ö–∞–≤–∞"
    
    # –ó–≤'—è–∑–æ–∫: –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –û–¥–∏–Ω–∏—Ü—é –≤–∏–º—ñ—Ä—É
    unit_id = Column(Integer, ForeignKey("units.id"))
    unit = relationship("Unit")

    # –°–∫–ª–∞–¥—Å—å–∫–∏–π –æ–±–ª—ñ–∫
    cost_per_unit = Column(Float, default=0.0)  # –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å
    stock_quantity = Column(Float, default=0.0) # –ó–∞–ª–∏—à–æ–∫

# --- –¢–û–í–ê–†–ò ---
class Product(Base):
    __tablename__ = "products"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True)
    price = Column(Float) # –¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É
    description = Column(String, nullable=True)
    
    # –ó–≤'—è–∑–æ–∫ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é
    category_id = Column(Integer, ForeignKey("categories.id"))
    category = relationship("Category")

    # –ó–≤'—è–∑–æ–∫ –∑ —Ä–µ—Ü–µ–ø—Ç–æ–º (—Å–ø–∏—Å–æ–∫ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤)
    recipe = relationship("ProductIngredient", back_populates="product", cascade="all, delete-orphan")

# --- –†–ï–¶–ï–ü–¢ (–ó–≤'—è–∑–æ–∫ –¢–æ–≤–∞—Ä <-> –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç) ---
class ProductIngredient(Base):
    __tablename__ = "product_ingredients"

    id = Column(Integer, primary_key=True, index=True)
    
    product_id = Column(Integer, ForeignKey("products.id"))
    ingredient_id = Column(Integer, ForeignKey("ingredients.id"))
    quantity = Column(Float) # –°–∫—ñ–ª—å–∫–∏ —Ü—å–æ–≥–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞ –π–¥–µ –Ω–∞ 1 –ø–æ—Ä—Ü—ñ—é
    
    # –ó–≤'—è–∑–∫–∏
    product = relationship("Product", back_populates="recipe")
    ingredient = relationship("Ingredient")    

from sqlalchemy import  # <--- –ù–ï –ó–ê–ë–£–î–¨ –¥–æ–¥–∞—Ç–∏ —Ü–µ –≤ —ñ–º–ø–æ—Ä—Ç –∑–≤–µ—Ä—Ö—É —Ñ–∞–π–ª—É!

# --- –Ü–°–¢–û–†–Ü–Ø –ó–ê–ú–û–í–õ–ï–ù–¨ (–ù–û–í–ï) ---
class Order(Base):
    __tablename__ = "orders"

    id = Column(Integer, primary_key=True, index=True)
    created_at = Column(DateTime, default=datetime.now) # –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø–æ–∫—É–ø–∫–∏
    total_price = Column(Float) # –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ —á–µ–∫—É
    payment_method = Column(String) # "cash" –∞–±–æ "card"
    
    # –ó–≤'—è–∑–æ–∫: –í –æ–¥–Ω–æ–º—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ –±–∞–≥–∞—Ç–æ —Ç–æ–≤–∞—Ä—ñ–≤
    items = relationship("OrderItem", back_populates="order", cascade="all, delete-orphan")

class OrderItem(Base):
    __tablename__ = "order_items"

    id = Column(Integer, primary_key=True, index=True)
    order_id = Column(Integer, ForeignKey("orders.id"))
    
    # –ú–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–∞–∑–≤—É —Ç–æ–≤–∞—Ä—É —Ç–µ–∫—Å—Ç–æ–º, –±–æ —è–∫—â–æ —Ç–∏ –≤–∏–¥–∞–ª–∏—à —Ç–æ–≤–∞—Ä "–ö–∞–≤–∞", 
    # –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –≤—ñ–Ω –º–∞—î –∑–∞–ª–∏—à–∏—Ç–∏—Å—è —è–∫ "–ö–∞–≤–∞".
    product_name = Column(String) 
    quantity = Column(Integer)
    price_at_moment = Column(Float) # –¶—ñ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏ (—Ä–∞–ø—Ç–æ–º –∑–∞–≤—Ç—Ä–∞ –ø–æ–¥–æ—Ä–æ–∂—á–∞—î)

    order = relationship("Order", back_populates="items")


========================================
FILE: product_service/Dockerfile
========================================
FROM python:3.9-slim

WORKDIR /app

# –°–ø–æ—á–∞—Ç–∫—É –∫–æ–ø—ñ—é—î–º–æ –≤–∏–º–æ–≥–∏ —ñ —Å—Ç–∞–≤–∏–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (—â–æ–± –∫–µ—à—É–≤–∞–ª–æ—Å—å)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –¢–ï–ü–ï–† –ö–û–ü–Ü–Æ–Ñ–ú–û –í–°–ï (–≤–∫–ª—é—á–∞—é—á–∏ models.py, schemas.py, database.py)
COPY . .

# –ó–∞–ø—É—Å–∫–∞—î–º–æ
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
