
========================================
FILE: docker-compose.yml
========================================
#version: '3.8'

services:
  # --- 1. –°–ï–†–í–Ü–° –¢–û–í–ê–†–Ü–í (Backend) ---
  product_service:
    build: ./product_service
    container_name: pos_product_service
    restart: always
    ports:
      - "8001:8000"
    environment:
      # –ó–≤'—è–∑–æ–∫ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö (postgres_db - —Ü–µ –Ω–∞–∑–≤–∞ —Å–µ—Ä–≤—ñ—Å—É –Ω–∏–∂—á–µ)
      - DATABASE_URL=postgresql://user:password@postgres_db:5432/products_db
    depends_on:
      - postgres_db

  # --- 2. –ë–ê–ó–ê –î–ê–ù–ò–• –¢–û–í–ê–†–Ü–í (PostgreSQL) ---
  postgres_db:
    image: postgres:13
    container_name: pos_postgres
    restart: always
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: products_db
    volumes:
      # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –Ω–∞ –¥–∏—Å–∫—É, —â–æ–± –Ω–µ –∑–Ω–∏–∫–∞–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
      - postgres_data:/var/lib/postgresql/data

  # --- 3. –°–ï–†–í–Ü–° –ö–û–®–ò–ö–ê (Backend) ---
  order_service:
    build: ./order_service
    container_name: pos_order_service
    restart: always
    environment:
      # –ó–≤'—è–∑–æ–∫ –∑ Redis
      - REDIS_HOST=redis_db
    depends_on:
      - redis_db

  # --- 4. –ë–ê–ó–ê –î–ê–ù–ò–• –ö–û–®–ò–ö–ê (Redis) ---
  redis_db:
    image: redis:alpine
    container_name: pos_redis
    restart: always

  # --- 5. –í–•–Ü–î–ù–Ü –í–û–†–û–¢–ê (Nginx) ---
  frontend:  # <-- –ù–û–í–ê –ù–ê–ó–í–ê (–±—É–ª–æ nginx –∞–±–æ gateway)
    build: ./frontend
    container_name: pos_frontend # <-- –ù–û–í–ï –Ü–ú'–Ø –ö–û–ù–¢–ï–ô–ù–ï–†–ê
    restart: always
    ports:
      - "8080:80"
    depends_on:
      - product_service
      - order_service

# –û–≥–æ–ª–æ—à—É—î–º–æ —Ç–æ–º–∏ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
volumes:
  postgres_data:


========================================
FILE: order_service/requirements.txt
========================================
fastapi
uvicorn
redis
pydantic


========================================
FILE: order_service/schemas.py
========================================
from pydantic import BaseModel
from typing import List, Optional

class ModifierItem(BaseModel):
    modifier_id: int

class CartItemCreate(BaseModel):
    product_id: int
    variant_id: Optional[int] = None
    modifiers: List[ModifierItem] = []
    quantity: int = 1
    # –ú–∏ –ø–µ—Ä–µ–¥–∞—î–º–æ —Ü—ñ –¥–∞–Ω—ñ –∑ —Ñ—Ä–æ–Ω—Ç—É, —â–æ–± –∫–æ—à–∏–∫ –Ω–µ —Ä–æ–±–∏–≤ –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ Product Service (—à–≤–∏–¥–∫–æ–¥—ñ—è)
    name: str 
    price: float

class CartItem(CartItemCreate):
    cart_item_id: str # –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID —Å–∞–º–µ —Ü—å–æ–≥–æ —Ä—è–¥–∫–∞ –≤ –∫–æ—à–∏–∫—É (UUID)

========================================
FILE: order_service/main.py
========================================
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
import redis
import os
import json
import uuid
from typing import List
from schemas import CartItemCreate, CartItem # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ —Å—Ö–µ–º–∏

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

REDIS_HOST = os.getenv("REDIS_HOST", "pos_redis")
REDIS_PORT = int(os.getenv("REDIS_PORT", 6379))

# decode_responses=True –µ–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞–º —á–∞—Å –Ω–∞ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –±–∞–π—Ç—ñ–≤
r = redis.Redis(host=REDIS_HOST, port=REDIS_PORT, db=0, decode_responses=True)
CART_KEY = "pos_cart_v2" # –ó–º—ñ–Ω–∏–º–æ –∫–ª—é—á, —â–æ–± –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É–≤–∞—Ç–∏ –∑—ñ —Å—Ç–∞—Ä–∏–º

@app.get("/")
def read_root():
    return {"message": "Advanced Order Service is running!"}

# --- –û–¢–†–ò–ú–ê–¢–ò –ö–û–®–ò–ö ---
@app.get("/cart/", response_model=List[CartItem])
def get_cart():
    # –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ –∑ —Ö–µ—à—É
    raw_data = r.hgetall(CART_KEY)
    cart_items = []
    
    for key, value in raw_data.items():
        try:
            item = json.loads(value)
            cart_items.append(item)
        except json.JSONDecodeError:
            continue
            
    return cart_items

# --- –î–û–î–ê–¢–ò –¢–û–í–ê–† ---
@app.post("/cart/add", response_model=CartItem)
def add_item(item_data: CartItemCreate):
    # –ì–µ–Ω–µ—Ä—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–ø–∏—Å—É –≤ –∫–æ—à–∏–∫—É
    # –¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–∞—Ç–∏ –¥–≤–∞ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞–º–∏
    cart_item_id = str(uuid.uuid4())
    
    new_item = CartItem(
        cart_item_id=cart_item_id,
        **item_data.dict()
    )
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ JSON –≤ Redis: Key=UUID, Value=JSON String
    r.hset(CART_KEY, cart_item_id, json.dumps(new_item.dict()))
    
    return new_item

# --- –ó–ú–Ü–ù–ò–¢–ò –ö–Ü–õ–¨–ö–Ü–°–¢–¨ (+/-) ---
@app.post("/cart/{cart_item_id}/update")
def update_quantity(cart_item_id: str, change: int):
    raw_json = r.hget(CART_KEY, cart_item_id)
    if not raw_json:
        raise HTTPException(status_code=404, detail="Item not found")
        
    item = json.loads(raw_json)
    new_qty = item['quantity'] + change
    
    if new_qty <= 0:
        # –Ø–∫—â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å <= 0, –≤–∏–¥–∞–ª—è—î–º–æ
        r.hdel(CART_KEY, cart_item_id)
        return {"status": "removed", "cart_item_id": cart_item_id}
    else:
        # –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
        item['quantity'] = new_qty
        r.hset(CART_KEY, cart_item_id, json.dumps(item))
        return {"status": "updated", "quantity": new_qty}

# --- –í–ò–î–ê–õ–ò–¢–ò –¢–û–í–ê–† ---
@app.delete("/cart/{cart_item_id}")
def remove_item(cart_item_id: str):
    r.hdel(CART_KEY, cart_item_id)
    return {"status": "removed"}

# --- –û–ß–ò–°–¢–ò–¢–ò –ö–û–®–ò–ö ---
@app.delete("/cart/")
def clear_cart():
    r.delete(CART_KEY)
    return {"status": "cleared"}

========================================
FILE: order_service/Dockerfile
========================================
FROM python:3.9-slim

WORKDIR /app

# –ö–æ–ø—ñ—é—î–º–æ requirements —ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# --- –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –¢–£–¢ ---
# –ö–æ–ø—ñ—é—î–º–æ –í–°–Ü —Ñ–∞–π–ª–∏ –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –ø–∞–ø–∫–∏ (main.py, schemas.py —ñ —Ç.–¥.)
COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

========================================
FILE: frontend/index.html
========================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HITS-POS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

========================================
FILE: frontend/vite.config.js
========================================
import { fileURLToPath, URL } from 'node:url'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    vue(),
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  server: {
    host: '0.0.0.0',
    port: 5173,
    proxy: {
      // 1. –ó–∞–ø–∏—Ç–∏ –¥–æ –ö–û–®–ò–ö–ê –π–¥—É—Ç—å –Ω–∞ order_service (8000)
      '/api/cart': {
        target: 'http://order_service:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '') 
      },
      // 2. –í—Å—ñ —ñ–Ω—à—ñ –∑–∞–ø–∏—Ç–∏ (Categories, Units, Products) –π–¥—É—Ç—å –Ω–∞ product_service (8001)
      '/api': {
        target: 'http://product_service:8000', // –í—Å–µ—Ä–µ–¥–∏–Ω—ñ Docker –º–µ—Ä–µ–∂—ñ –≤–æ–Ω–∏ –≤—Å—ñ —Å–ª—É—Ö–∞—é—Ç—å 8000
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})

========================================
FILE: frontend/README.md
========================================
# Vue 3 + Vite

This template should help get you started developing with Vue 3 in Vite. The template uses Vue 3 `<script setup>` SFCs, check out the [script setup docs](https://v3.vuejs.org/api/sfc-script-setup.html#sfc-script-setup) to learn more.

Learn more about IDE Support for Vue in the [Vue Docs Scaling up Guide](https://vuejs.org/guide/scaling-up/tooling.html#ide-support).


========================================
FILE: frontend/package.json
========================================
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.5.24"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@vitejs/plugin-vue": "^6.0.1",
    "autoprefixer": "^10.4.17",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.4"
  }
}


========================================
FILE: frontend/postcss.config.js
========================================
export default {
  plugins: {
    tailwindcss: {}, // –ù—ñ—è–∫–∏—Ö —Å–æ–±–∞—á–æ–∫ @tailwindcss/postcss! –ü—Ä–æ—Å—Ç–æ tailwindcss.
    autoprefixer: {},
  },
}

========================================
FILE: frontend/nginx.conf
========================================
server {
    listen 80;
    server_name localhost;

    # 1. –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (–§—Ä–æ–Ω—Ç–µ–Ω–¥)
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html; # –î–ª—è —Ä–æ–±–æ—Ç–∏ Vue Router (—â–æ–± –Ω–µ –±—É–ª–æ 404 –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ)
    }

    # 2. –ü—Ä–æ–∫—Å—ñ –¥–ª—è –ö–û–®–ò–ö–ê (Order Service)
    # –ó–∞–ø–∏—Ç /api/cart/... –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ http://order_service:8000/cart/...
    location /api/cart {
        # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api, –∑–∞–ª–∏—à–∞—î–º–æ /cart
        rewrite ^/api/(.*) /$1 break;
        proxy_pass http://order_service:8000;
        proxy_set_header Host $host;
    }

    # 3. –ü—Ä–æ–∫—Å—ñ –¥–ª—è –¢–û–í–ê–†–Ü–í (Product Service) - –≤—Å–µ —ñ–Ω—à–µ api
    # –ó–∞–ø–∏—Ç /api/units/... –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ http://product_service:8000/units/...
    location /api/ {
        # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api
        rewrite ^/api/(.*) /$1 break;
        proxy_pass http://product_service:8000;
        proxy_set_header Host $host;
    }
}

========================================
FILE: frontend/Dockerfile
========================================
# --- –ï–¢–ê–ü 1: –ó–±—ñ—Ä–∫–∞ (Build) ---
# –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û –í–ï–†–°–Ü–Æ 22, –±–æ Vite 6/7 —Ü—å–æ–≥–æ –≤–∏–º–∞–≥–∞—î
FROM node:22-alpine as build-stage

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN npm run build

# --- –ï–¢–ê–ü 2: –ü—Ä–æ–¥–∞–∫—à–Ω (Nginx) ---
FROM nginx:alpine as production-stage

COPY --from=build-stage /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]

========================================
FILE: frontend/tailwind.config.js
========================================
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

========================================
FILE: frontend/src/App.vue
========================================
<script setup>
import { ref, onMounted } from 'vue'
import Sidebar from './components/Sidebar.vue'
import ProductCard from './components/ProductCard.vue'
import CartDrawer from './components/CartDrawer.vue'
import Warehouse from './components/Warehouse.vue'
import Statistics from './components/Statistics.vue'
import Customers from './components/Customers.vue'
import ProductModal from './components/ProductModal.vue'

const currentPage = ref('pos')
const products = ref([])
const loading = ref(true)
const cartCount = ref(0)
const isCartOpen = ref(false)

// –°—Ç–∞–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
const isModalOpen = ref(false)
const selectedProduct = ref(null)

// --- –ù–û–í–ï: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ—à–∏–∫–∞ ---
const cartDrawerRef = ref(null)

const fetchProducts = async () => {
  try {
    const res = await fetch('/api/products/') 
    if (res.ok) products.value = await res.json()
    else products.value = [] 
  } catch (err) {
    console.error(err)
  } finally {
    loading.value = false
  }
}

const updateCartCount = async () => {
  try {
    const res = await fetch('/api/cart/')
    const cartItems = await res.json()
    cartCount.value = cartItems.reduce((sum, item) => sum + item.quantity, 0)
  } catch (err) { console.error(err) }
}

const handleProductClick = (product) => {
  if (product.has_variants || (product.modifier_groups && product.modifier_groups.length > 0)) {
    selectedProduct.value = product
    isModalOpen.value = true
  } else {
    addToCart({ 
        product: product,
        variant_id: null,
        modifiers: [],
        finalPrice: product.price,
        generatedName: product.name
    })
  }
}

const handleModalAddToCart = async (payload) => {
    await addToCart(payload)
}

const addToCart = async (payload) => {
  const cartPayload = {
      product_id: payload.product.id,
      variant_id: payload.variant_id,
      modifiers: payload.modifiers, 
      quantity: 1,
      name: payload.generatedName,
      price: payload.finalPrice    
  }

  try {
    const res = await fetch('/api/cart/add', { 
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(cartPayload)
    })
    
    if (res.ok) {
        // –û–Ω–æ–≤–ª—é—î–º–æ –±–µ–π–¥–∂ –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é
        await updateCartCount()
        
        // --- –í–ê–ñ–õ–ò–í–û: –ü—Ä–∏–º—É—Å–æ–≤–æ –æ–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ —É –∫–æ—à–∏–∫—É! ---
        if (cartDrawerRef.value) {
            await cartDrawerRef.value.loadCart()
        }
    } else {
        console.error("–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ –∫–æ—à–∏–∫")
    }
  } catch (err) { console.error(err) }
}

onMounted(() => {
  fetchProducts()
  updateCartCount()
})
</script>

<template>
  <div class="flex h-screen bg-gray-50 text-gray-800 font-sans overflow-hidden">
    <Sidebar :current-page="currentPage" @change-page="(page) => currentPage = page" />

    <main v-if="currentPage === 'pos'" class="flex-1 ml-64 flex flex-col h-screen relative">
      <header class="bg-white/80 backdrop-blur-md sticky top-0 z-10 border-b border-gray-200 px-8 py-4 flex justify-between items-center">
        <div>
          <h2 class="text-2xl font-bold text-gray-800">–ú–µ–Ω—é</h2>
          <p class="text-sm text-gray-500">–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä–∏ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
        </div>
        <button @click="isCartOpen = true" class="bg-gray-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-800 transition shadow-lg flex items-center gap-3 active:scale-95">
          <i class="fas fa-shopping-cart"></i> <span>–ö–æ—à–∏–∫: {{ cartCount }}</span>
        </button>
      </header>

      <div class="p-8 overflow-y-auto flex-1 custom-scrollbar">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
          <ProductCard 
            v-for="item in products" 
            :key="item.id" 
            :product="item" 
            @click="handleProductClick(item)" 
          />
        </div>
      </div>

      <CartDrawer 
        ref="cartDrawerRef"
        :is-open="isCartOpen"
        :products="products"
        @close="isCartOpen = false"
        @clear-cart="updateCartCount"
      />
      
      <ProductModal 
        :is-open="isModalOpen"
        :product="selectedProduct"
        @close="isModalOpen = false"
        @add-to-cart="handleModalAddToCart"
      />
    </main>

    <Warehouse v-if="currentPage === 'warehouse'" />
    <Statistics v-if="currentPage === 'statistics'" />
    <Customers v-if="currentPage === 'customers'" />
  </div>
</template>

========================================
FILE: frontend/src/style.css
========================================
@tailwind base;
@tailwind components;
@tailwind utilities;


========================================
FILE: frontend/src/main.js
========================================
import { createApp } from 'vue'
import './style.css'
import App from './App.vue'

createApp(App).mount('#app')


========================================
FILE: frontend/src/components/ProductCard.vue
========================================
<script setup>
import { computed } from 'vue'

const props = defineProps({ product: Object })

const productIcon = computed(() => {
  const name = props.product.name.toLowerCase()
  const cat = props.product.category?.name?.toLowerCase() || ''
  if (name.includes('–∫–∞–≤–∞') || name.includes('–µ—Å–ø—Ä–µ—Å–æ') || cat.includes('–Ω–∞–ø–æ—ó')) return 'fas fa-mug-hot'
  if (name.includes('—á–∞–π')) return 'fas fa-leaf'
  if (name.includes('—Ç–æ—Ä—Ç') || name.includes('–¥–µ—Å–µ—Ä—Ç') || cat.includes('–¥–µ—Å–µ—Ä—Ç–∏')) return 'fas fa-birthday-cake'
  if (name.includes('–∫—Ä—É–∞—Å–∞–Ω')) return 'fas fa-bread-slice'
  return 'fas fa-box'
})

const cardColor = computed(() => {
  const cat = props.product.category?.slug || ''
  if (cat === 'hot-drinks') return 'bg-orange-50 text-orange-600 border-orange-100'
  if (cat === 'desserts') return 'bg-pink-50 text-pink-600 border-pink-100'
  return 'bg-white text-gray-700 border-gray-100'
})

const hasOptions = computed(() => {
    return props.product.has_variants || (props.product.modifier_groups && props.product.modifier_groups.length > 0)
})

// --- –ù–û–í–ï: –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è ---
const displayPrice = computed(() => {
  if (props.product.has_variants && props.product.variants.length > 0) {
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É —Ü—ñ–Ω—É —Å–µ—Ä–µ–¥ —É—Å—ñ—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
    const prices = props.product.variants.map(v => v.price)
    return Math.min(...prices)
  }
  // –Ø–∫—â–æ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –Ω–µ–º–∞—î, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω—É —Ü—ñ–Ω—É
  return props.product.price
})
</script>

<template>
  <div class="relative group cursor-pointer transition-all duration-200 hover:-translate-y-1 hover:shadow-xl rounded-2xl border overflow-hidden bg-white">
    <div class="h-32 flex items-center justify-center text-5xl transition-transform group-hover:scale-110" :class="cardColor">
      <i :class="productIcon"></i>
    </div>

    <div class="p-4">
      <div v-if="product.category" class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-1">
        {{ product.category.name }}
      </div>
      
      <h3 class="font-bold text-lg text-gray-800 leading-tight mb-2">{{ product.name }}</h3>
      
      <div class="flex justify-between items-center mt-3">
        <div class="flex flex-col">
            <span v-if="product.has_variants" class="text-xs text-gray-400">–≤—ñ–¥</span>
            <span class="text-xl font-bold text-gray-900">{{ displayPrice }} ‚Ç¥</span>
        </div>
        
        <button class="w-8 h-8 rounded-full flex items-center justify-center transition shadow-lg"
            :class="hasOptions ? 'bg-purple-600 hover:bg-purple-700 text-white' : 'bg-gray-900 hover:bg-green-500 text-white'">
          <i class="fas" :class="hasOptions ? 'fa-sliders-h text-xs' : 'fa-plus text-xs'"></i>
        </button>
      </div>
    </div>
  </div>
</template>

========================================
FILE: frontend/src/components/HelloWorld.vue
========================================
<script setup>
import { ref } from 'vue'

defineProps({
  msg: String,
})

const count = ref(0)
</script>

<template>
  <h1>{{ msg }}</h1>

  <div class="card">
    <button type="button" @click="count++">count is {{ count }}</button>
    <p>
      Edit
      <code>components/HelloWorld.vue</code> to test HMR
    </p>
  </div>

  <p>
    Check out
    <a href="https://vuejs.org/guide/quick-start.html#local" target="_blank"
      >create-vue</a
    >, the official Vue + Vite starter
  </p>
  <p>
    Learn more about IDE Support for Vue in the
    <a
      href="https://vuejs.org/guide/scaling-up/tooling.html#ide-support"
      target="_blank"
      >Vue Docs Scaling up Guide</a
    >.
  </p>
  <p class="read-the-docs">Click on the Vite and Vue logos to learn more</p>
</template>

<style scoped>
.read-the-docs {
  color: #888;
}
</style>


========================================
FILE: frontend/src/components/Warehouse.vue
========================================
<script setup>
import { ref, onMounted, computed } from 'vue'
import IngredientSelect from './IngredientSelect.vue'

const activeTab = ref('products') 
const categories = ref([]); const units = ref([]); const ingredients = ref([]); const products = ref([]);
const loading = ref(false)

// Forms for simple data
const newCategory = ref({ name: '', slug: '', color: '#3b82f6', parent_id: '' }) 
const newUnit = ref({ name: '', symbol: '' })
const newIngredient = ref({ name: '', unit_id: '', cost_per_unit: 0, stock_quantity: 0 })

// --- –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –Ü–ù–ì–†–ï–î–Ü–Ñ–ù–¢–ê ---
const showEditIngModal = ref(false)
const editIngData = ref({ id: null, name: '', unit_id: '', cost_per_unit: 0 })

// --- –¢–û–í–ê–† (Create / Edit Logic) ---
const isVariantMode = ref(false)
const editingProductId = ref(null) // ID —Ç–æ–≤–∞—Ä—É, —è–∫–∏–π —Ä–µ–¥–∞–≥—É—î–º–æ (null = —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ)
const productSearch = ref('') // <--- –ù–û–í–ï: –ü–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç

const newProduct = ref({
  name: '', description: '', category_id: '',
  price: 0, recipe: [], variants: [], modifier_groups: []
})
const variantBuilder = ref({ name: '', price: 0, recipe: [] })
const modGroupBuilder = ref({ name: '', is_required: false, modifiers: [] })

// --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø ---
const fetchData = async () => {
  loading.value = true
  try {
    const [c, u, i, p] = await Promise.all([
      fetch('/api/categories/').then(r=>r.json()),
      fetch('/api/units/').then(r=>r.json()),
      fetch('/api/ingredients/').then(r=>r.json()),
      fetch('/api/products/').then(r=>r.json())
    ])
    categories.value = c; units.value = u; ingredients.value = i; products.value = p;
  } catch (e) { console.error(e) } finally { loading.value = false }
}

// --- –ù–û–í–ï: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–æ–≤–∞—Ä—ñ–≤ ---
const filteredProducts = computed(() => {
    if (!productSearch.value) return products.value
    const lower = productSearch.value.toLowerCase()
    return products.value.filter(p => p.name.toLowerCase().includes(lower))
})

// --- –§–£–ù–ö–¶–Ü–á –î–õ–Ø –ü–†–û–°–¢–ò–• –î–ê–ù–ò–• (Categories, Units, Ingredients) ---
const createUnit = async () => {
    if(!newUnit.value.name || !newUnit.value.symbol) return alert("–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ —Å–∏–º–≤–æ–ª")
    await fetch('/api/units/', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(newUnit.value) })
    newUnit.value = { name: '', symbol: '' }; fetchData()
}
const createIngredient = async () => { 
    if(!newIngredient.value.name || !newIngredient.value.unit_id) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è")
    await fetch('/api/ingredients/', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(newIngredient.value) }); 
    newIngredient.value = { name: '', unit_id: '', cost_per_unit: 0, stock_quantity: 0 }; fetchData() 
}
const deleteIngredient = async (id) => {
    if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏?")) return
    const res = await fetch(`/api/ingredients/${id}`, { method: 'DELETE' })
    if(res.ok) fetchData() 
}
const openEditIngModal = (ing) => {
    editIngData.value = { ...ing }
    showEditIngModal.value = true
}
const updateIngredient = async () => {
    const res = await fetch(`/api/ingredients/${editIngData.value.id}`, { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(editIngData.value) })
    if(res.ok) { showEditIngModal.value = false; fetchData() }
}
const createCategory = async () => { 
    if(!newCategory.value.name || !newCategory.value.slug) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–æ–¥")
    await fetch('/api/categories/', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(newCategory.value) }); 
    newCategory.value = { name: '', slug: '', color: '#3b82f6', parent_id: '' }; fetchData()
}

// --- –õ–û–ì–Ü–ö–ê –¢–û–í–ê–†–Ü–í ---

// 1. –°–∫–∏–¥–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏
const resetProductForm = () => {
    editingProductId.value = null
    isVariantMode.value = false
    newProduct.value = {
        name: '', description: '', category_id: '',
        price: 0, recipe: [], variants: [], modifier_groups: []
    }
}

// 2. –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
const editProduct = (p) => {
    editingProductId.value = p.id
    isVariantMode.value = p.has_variants
    
    newProduct.value = {
        name: p.name,
        description: p.description || '',
        category_id: p.category_id,
        price: p.price,
        recipe: p.recipe ? p.recipe.map(r => ({ ingredient_id: r.ingredient_id, quantity: r.quantity })) : [],
        variants: p.variants ? p.variants.map(v => ({
            name: v.name,
            price: v.price,
            sku: v.sku,
            recipe: v.variant_recipe ? v.variant_recipe.map(vr => ({ ingredient_id: vr.ingredient_id, quantity: vr.quantity })) : (v.recipe || [])
        })) : [],
        modifier_groups: p.modifier_groups ? JSON.parse(JSON.stringify(p.modifier_groups)) : []
    }
}

// 3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ê–ë–û –û–Ω–æ–≤–ª–µ–Ω–Ω—è)
const saveProduct = async () => {
    const p = newProduct.value
    if (!p.name || !p.category_id) return alert("–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é!")
    
    const payload = {
        name: p.name, description: p.description, category_id: p.category_id,
        has_variants: isVariantMode.value, price: isVariantMode.value ? 0 : p.price,
        recipe: p.recipe.filter(r => r.ingredient_id && r.quantity > 0),
        variants: p.variants.map(v => ({ ...v, recipe: v.recipe.filter(r => r.ingredient_id && r.quantity > 0) })),
        modifier_groups: p.modifier_groups
    }

    let url = '/api/products/'
    let method = 'POST'
    
    if (editingProductId.value) {
        url = `/api/products/${editingProductId.value}`
        method = 'PUT'
    }

    const res = await fetch(url, { method: method, headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) })
    
    if(res.ok) { 
        alert(editingProductId.value ? "–¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ!" : "–¢–æ–≤–∞—Ä —Å—Ç–≤–æ—Ä–µ–Ω–æ!")
        fetchData()
        resetProductForm()
    } else { 
        alert("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è") 
    }
}

// –•–µ–ª–ø–µ—Ä–∏ –¥–ª—è –º–∞—Å–∏–≤—ñ–≤
const addIngToRecipe = (arr) => arr.push({ ingredient_id: '', quantity: 0 })
const removeIngFromRecipe = (arr, idx) => arr.splice(idx, 1)
const addVariant = () => {
    if(!variantBuilder.value.name || !variantBuilder.value.price) return alert("–í–∫–∞–∂—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ —Ü—ñ–Ω—É")
    newProduct.value.variants.push({ ...variantBuilder.value, recipe: JSON.parse(JSON.stringify(variantBuilder.value.recipe)) })
    variantBuilder.value = { name: '', price: 0, recipe: [] }
}
const removeVariant = (idx) => newProduct.value.variants.splice(idx, 1)
const getParentName = (id) => { const p = categories.value.find(c => c.id === id); return p ? p.name : '-' }

onMounted(fetchData)
</script>

<template>
  <div class="p-8 h-screen overflow-y-auto bg-gray-50 ml-64 custom-scrollbar">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold text-gray-800">üì¶ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</h2>
      <button @click="fetchData" class="text-blue-600 hover:bg-blue-50 p-2 rounded-full"><i class="fas fa-sync-alt"></i></button>
    </div>

    <div class="flex space-x-1 bg-gray-200 p-1 rounded-xl w-fit mb-8">
      <button @click="activeTab='products'" :class="activeTab==='products'?'bg-white text-purple-600 shadow-sm':''" class="px-6 py-2 rounded-lg font-bold transition-all">–¢–æ–≤–∞—Ä–∏</button>
      <button @click="activeTab='ingredients'" :class="activeTab==='ingredients'?'bg-white text-blue-600 shadow-sm':''" class="px-6 py-2 rounded-lg font-bold transition-all">–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</button>
      <button @click="activeTab='units'" :class="activeTab==='units'?'bg-white text-blue-600 shadow-sm':''" class="px-6 py-2 rounded-lg font-bold transition-all">–û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º.</button>
      <button @click="activeTab='categories'" :class="activeTab==='categories'?'bg-white text-blue-600 shadow-sm':''" class="px-6 py-2 rounded-lg font-bold transition-all">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
    </div>

    <div v-if="activeTab === 'products'" class="grid grid-cols-1 xl:grid-cols-3 gap-8">
       <div class="xl:col-span-2 flex flex-col gap-4 h-fit">
        
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-3">
             <i class="fas fa-search text-gray-400 ml-2"></i>
             <input v-model="productSearch" type="text" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É..." class="w-full outline-none text-gray-700">
             <span class="text-xs text-gray-400 font-bold uppercase">{{ filteredProducts.length }} –∑–Ω–∞–π–¥–µ–Ω–æ</span>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <table class="w-full text-left">
            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                <tr>
                    <th class="p-4">–ù–∞–∑–≤–∞</th>
                    <th class="p-4">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th> <th class="p-4">–¢–∏–ø</th>
                    <th class="p-4 text-right">–¶—ñ–Ω–∞</th>
                    <th class="p-4"></th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="filteredProducts.length === 0">
                    <td colspan="5" class="p-8 text-center text-gray-400">–¢–æ–≤–∞—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</td>
                </tr>
                <tr v-for="p in filteredProducts" :key="p.id" class="border-b hover:bg-gray-50 transition">
                <td class="p-4 font-bold text-gray-800">{{ p.name }}</td>
                
                <td class="p-4">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full" :style="{ backgroundColor: p.category?.color || '#ccc' }"></div>
                        <span class="text-sm font-medium text-gray-600">{{ p.category?.name || '-' }}</span>
                    </div>
                </td>

                <td class="p-4 text-xs uppercase font-bold" :class="p.has_variants ? 'text-purple-600':'text-gray-500'">
                    {{ p.has_variants ? '–í–∞—Ä—ñ–∞–Ω—Ç–∏' : '–ü—Ä–æ—Å—Ç–∏–π' }}
                </td>
                <td class="p-4 text-right font-mono">
                    {{ p.has_variants && p.variants.length > 0 ? `${p.variants[0].price} - ...` : p.price }} ‚Ç¥
                </td>
                <td class="p-4 text-right">
                    <button @click="editProduct(p)" class="text-gray-400 hover:text-blue-600 px-2 transition"><i class="fas fa-pen"></i></button>
                </td>
                </tr>
            </tbody>
            </table>
        </div>
      </div>
      
       <div class="bg-white p-6 rounded-2xl shadow-sm border border-purple-100 border-2 h-fit sticky top-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold" :class="editingProductId ? 'text-blue-700' : 'text-purple-700'">
                <i class="fas" :class="editingProductId ? 'fa-edit' : 'fa-plus-circle'"></i> 
                {{ editingProductId ? '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É' : '–ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä' }}
            </h3>
            <button v-if="editingProductId" @click="resetProductForm" class="text-xs text-red-500 hover:underline">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
        
        <div class="space-y-4">
            <input v-model="newProduct.name" type="text" placeholder="–ù–∞–∑–≤–∞ (–Ω–∞–ø—Ä. –ö–∞–≤–∞ Delicate)" class="w-full border p-2 rounded focus:ring-2 ring-purple-100 outline-none">
            <select v-model="newProduct.category_id" class="w-full border p-2 rounded bg-white">
                <option value="" disabled>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                <option v-for="c in categories" :key="c.id" :value="c.id">{{ c.name }}</option>
            </select>
            
            <div class="flex items-center gap-3 bg-gray-100 p-2 rounded-lg">
                <span class="text-xs font-bold uppercase text-gray-500 ml-2">–¢–∏–ø:</span>
                <button @click="isVariantMode=false" :class="!isVariantMode ? 'bg-white shadow text-gray-800':'text-gray-400'" class="flex-1 py-1 rounded text-sm font-bold transition">–ü—Ä–æ—Å—Ç–∏–π</button>
                <button @click="isVariantMode=true" :class="isVariantMode ? 'bg-white shadow text-purple-600':'text-gray-400'" class="flex-1 py-1 rounded text-sm font-bold transition">–ó –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏</button>
            </div>

             <div v-if="!isVariantMode" class="space-y-3 animate-fade-in">
                <input v-model="newProduct.price" type="number" placeholder="–¶—ñ–Ω–∞ (‚Ç¥)" class="w-full border p-2 rounded font-bold text-right">
                <div class="border-t border-dashed pt-2">
                    <label class="text-xs font-bold text-gray-400 uppercase">–†–µ—Ü–µ–ø—Ç</label>
                    <div v-for="(row, idx) in newProduct.recipe" :key="idx" class="flex gap-2 mt-1 items-center">
                        <div class="flex-1"><IngredientSelect v-model="row.ingredient_id" :ingredients="ingredients" /></div>
                        <input v-model="row.quantity" type="number" step="0.001" placeholder="–ö—ñ–ª" class="w-16 text-sm border rounded p-1.5 h-[38px]">
                        <button @click="removeIngFromRecipe(newProduct.recipe, idx)" class="text-red-400 hover:text-red-600 px-2"><i class="fas fa-times"></i></button>
                    </div>
                    <button @click="addIngToRecipe(newProduct.recipe)" class="text-xs text-blue-500 font-bold mt-2 flex items-center gap-1 hover:text-blue-700"><i class="fas fa-plus"></i> –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</button>
                </div>
            </div>

            <div v-if="isVariantMode" class="bg-purple-50 p-3 rounded-xl border border-purple-100 animate-fade-in">
                
                <div v-if="newProduct.variants.length > 0" class="mb-4 space-y-2">
                    <label class="text-xs font-bold text-purple-600 uppercase">–°–ø–∏—Å–æ–∫ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤:</label>
                    <div v-for="(v, idx) in newProduct.variants" :key="idx" class="flex justify-between text-sm bg-white p-2 rounded border border-purple-100 shadow-sm items-center">
                        <div class="flex flex-col">
                            <span class="font-bold text-gray-700">{{ v.name }} <span class="text-gray-400 font-normal">({{ v.price }} ‚Ç¥)</span></span>
                            <span class="text-[10px] text-gray-400">{{ v.recipe.length }} —ñ–Ω–≥—Ä.</span>
                        </div>
                        <button @click="removeVariant(idx)" class="text-gray-400 hover:text-red-500 transition"><i class="fas fa-trash"></i></button>
                    </div>
                </div>

                <div class="bg-white/50 p-2 rounded-lg border border-dashed border-purple-200">
                    <label class="text-[10px] font-bold text-gray-400 uppercase mb-1 block">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç</label>
                    <div class="flex gap-2 mb-2">
                        <input v-model="variantBuilder.name" placeholder="–ù–∞–∑–≤–∞ (250–≥)" class="flex-1 text-sm border p-1 rounded">
                        <input v-model="variantBuilder.price" type="number" placeholder="–¶—ñ–Ω–∞" class="w-20 text-sm border p-1 rounded">
                    </div>
                    <div class="bg-white p-2 rounded border border-purple-100 mb-2">
                          <div v-for="(row, idx) in variantBuilder.recipe" :key="idx" class="flex gap-1 mb-2 items-center">
                            <div class="flex-1"><IngredientSelect v-model="row.ingredient_id" :ingredients="ingredients" /></div>
                            <input v-model="row.quantity" type="number" step="0.001" class="w-16 text-xs border rounded p-1.5 h-[38px]">
                            <button @click="removeIngFromRecipe(variantBuilder.recipe, idx)" class="text-red-400 text-xs px-2 hover:text-red-600"><i class="fas fa-times"></i></button>
                          </div>
                          <button @click="addIngToRecipe(variantBuilder.recipe)" class="text-xs text-purple-500 font-bold hover:text-purple-700 flex items-center gap-1"><i class="fas fa-plus"></i> –°–∫–ª–∞–¥</button>
                    </div>
                    <button @click="addVariant" class="w-full bg-purple-200 text-purple-800 text-sm font-bold py-2 rounded hover:bg-purple-300 transition shadow-sm">–î–æ–¥–∞—Ç–∏ –≤ —Å–ø–∏—Å–æ–∫</button>
                </div>
            </div>

            <button @click="saveProduct" 
                class="w-full text-white py-3 rounded-xl font-bold shadow-lg mt-4 transition transform active:scale-95"
                :class="editingProductId ? 'bg-blue-600 hover:bg-blue-700' : 'bg-green-600 hover:bg-green-700'">
                {{ editingProductId ? '–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏' : '–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–æ–≤–∞—Ä' }}
            </button>
        </div>
      </div>
    </div>

    <div v-if="activeTab === 'ingredients'" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit">
             <h3 class="font-bold mb-6 text-gray-700 border-b pb-2">üå± –ù–æ–≤–∏–π —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</h3>
             <div class="space-y-5">
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ù–∞–∑–≤–∞ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞</label><input v-model="newIngredient.name" placeholder="–ù–∞–ø—Ä. –ö–∞–≤–∞ –≤ –∑–µ—Ä–Ω–∞—Ö" class="border p-2 rounded-lg w-full bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition"></div>
                 <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–û–¥–∏–Ω–∏—Ü—è –≤–∏–º—ñ—Ä—É</label><select v-model="newIngredient.unit_id" class="border p-2 rounded-lg w-full bg-white h-[42px]"><option value="" disabled>–û–±–µ—Ä—ñ—Ç—å...</option><option v-for="u in units" :key="u.id" :value="u.id">{{u.name}} ({{u.symbol}})</option></select></div>
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å (‚Ç¥/–æ–¥)</label><input v-model="newIngredient.cost_per_unit" type="number" placeholder="0.00" class="border p-2 rounded-lg w-full"></div>
                 </div>
                 <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ª–∏—à–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥—ñ</label><input v-model="newIngredient.stock_quantity" type="number" placeholder="0" class="border p-2 rounded-lg w-full"></div>
                 <button @click="createIngredient" class="bg-blue-600 hover:bg-blue-700 text-white w-full py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition mt-2"><i class="fas fa-plus mr-2"></i> –î–æ–¥–∞—Ç–∏ –≤ –±–∞–∑—É</button>
             </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500 uppercase text-xs"><tr><th class="p-4">–ù–∞–∑–≤–∞</th><th class="p-4 text-right">–ó–∞–ª–∏—à–æ–∫</th><th class="p-4 text-center">–î—ñ—ó</th></tr></thead>
                <tbody class="divide-y divide-gray-100"><tr v-for="i in ingredients" :key="i.id" class="hover:bg-gray-50"><td class="p-4 font-bold text-gray-700">{{ i.name }}<div class="text-xs text-gray-400 font-normal">–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å: {{ i.cost_per_unit }} ‚Ç¥/{{ i.unit?.symbol }}</div></td><td class="p-4 text-right font-mono text-lg" :class="i.stock_quantity > 0 ? 'text-green-600' : 'text-red-500'">{{ i.stock_quantity }} <span class="text-xs text-gray-400 font-sans">{{ i.unit?.symbol }}</span></td><td class="p-4 text-center"><div class="flex justify-center gap-2"><button @click="openEditIngModal(i)" class="text-gray-400 hover:text-blue-500 px-2"><i class="fas fa-pen"></i></button><button @click="deleteIngredient(i.id)" class="text-gray-400 hover:text-red-500 px-2"><i class="fas fa-trash"></i></button></div></td></tr></tbody>
            </table>
        </div>
    </div>
    
    <div v-if="activeTab === 'units'" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
         <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit"><h3 class="font-bold mb-4 text-gray-700">üìè –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–¥–∏–Ω–∏—Ü—é –≤–∏–º—ñ—Ä—É</h3><div class="space-y-3"><input v-model="newUnit.name" placeholder="–ù–∞–∑–≤–∞ (–Ω–∞–ø—Ä. –ì—Ä–∞–º–∏)" class="border p-2 rounded w-full"><input v-model="newUnit.symbol" placeholder="–°–∏–º–≤–æ–ª (–Ω–∞–ø—Ä. –≥)" class="border p-2 rounded w-full"><button @click="createUnit" class="bg-blue-600 hover:bg-blue-700 text-white w-full py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div></div>
         <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100"><table class="w-full text-sm text-left"><thead class="bg-gray-50 text-gray-500 uppercase text-xs"><tr><th class="p-4">–ù–∞–∑–≤–∞</th><th class="p-4 text-right">–°–∏–º–≤–æ–ª</th></tr></thead><tbody class="divide-y divide-gray-100"><tr v-for="u in units" :key="u.id" class="hover:bg-gray-50"><td class="p-4 font-bold text-gray-700">{{ u.name }}</td><td class="p-4 text-right font-mono">{{ u.symbol }}</td></tr></tbody></table></div>
    </div>
    
    <div v-if="activeTab === 'categories'" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit"><h3 class="font-bold mb-4 text-gray-700">üìÇ –ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è</h3><div class="space-y-4"><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ù–∞–∑–≤–∞</label><input v-model="newCategory.name" class="border p-2 rounded w-full"></div><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ö–æ–¥</label><input v-model="newCategory.slug" class="border p-2 rounded w-full font-mono text-sm"></div><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ö–æ–ª—ñ—Ä</label><div class="flex items-center gap-2"><input v-model="newCategory.color" type="color" class="h-10 w-16 border rounded cursor-pointer"><span class="text-sm text-gray-600">{{ newCategory.color }}</span></div></div><div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ë–∞—Ç—å–∫–æ</label><select v-model="newCategory.parent_id" class="border p-2 rounded w-full bg-white"><option value="">(–ù–µ–º–∞—î)</option><option v-for="c in categories" :key="c.id" :value="c.id">{{ c.name }}</option></select></div><button @click="createCategory" class="bg-blue-600 text-white w-full py-3 rounded-xl font-bold hover:bg-blue-700 shadow-lg mt-2">–°—Ç–≤–æ—Ä–∏—Ç–∏</button></div></div>
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"><table class="w-full text-sm text-left"><thead class="bg-gray-50 text-gray-500 uppercase text-xs"><tr><th class="p-4">–ö–æ–ª—ñ—Ä</th><th class="p-4">–ù–∞–∑–≤–∞</th><th class="p-4">–ö–æ–¥</th><th class="p-4">–ë–∞—Ç—å–∫–æ</th></tr></thead><tbody class="divide-y divide-gray-100"><tr v-for="c in categories" :key="c.id" class="hover:bg-gray-50"><td class="p-4"><div class="w-8 h-8 rounded-lg shadow-sm border border-gray-200" :style="{ backgroundColor: c.color || '#fff' }"></div></td><td class="p-4 font-bold text-gray-800 text-lg">{{ c.name }}</td><td class="p-4 font-mono text-gray-500">{{ c.slug }}</td><td class="p-4"><span v-if="c.parent_id" class="bg-blue-50 text-blue-600 px-2 py-1 rounded text-xs font-bold">{{ getParentName(c.parent_id) }}</span><span v-else class="text-gray-300 text-xs">-</span></td></tr></tbody></table></div>
    </div>

    <div v-if="showEditIngModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm"><div class="bg-white p-6 rounded-2xl shadow-2xl w-96"><h3 class="text-xl font-bold mb-4">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç</h3><div class="space-y-3"><div><label class="text-xs font-bold text-gray-500 uppercase">–ù–∞–∑–≤–∞</label><input v-model="editIngData.name" class="border p-2 rounded w-full"></div><div><label class="text-xs font-bold text-gray-500 uppercase">–û–¥–∏–Ω–∏—Ü—è</label><select v-model="editIngData.unit_id" class="border p-2 rounded w-full bg-white"><option v-for="u in units" :key="u.id" :value="u.id">{{u.name}} ({{u.symbol}})</option></select></div><div><label class="text-xs font-bold text-gray-500 uppercase">–¶—ñ–Ω–∞</label><input v-model="editIngData.cost_per_unit" type="number" class="border p-2 rounded w-full"></div><div class="flex gap-2 mt-4"><button @click="showEditIngModal=false" class="flex-1 py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-lg">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button @click="updateIngredient" class="flex-1 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div></div></div></div>

  </div>
</template>

<style scoped>
.animate-fade-in { animation: fadeIn 0.3s ease-in; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>

========================================
FILE: frontend/src/components/Statistics.vue
========================================
<script setup>
import { ref, onMounted } from 'vue'

const orders = ref([])
const loading = ref(true)

// –î–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
const showDetailModal = ref(false)
const selectedOrder = ref(null)

// –§—É–Ω–∫—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
const formatDate = (dateString) => {
  const date = new Date(dateString)
  return date.toLocaleString('uk-UA', {
    day: '2-digit', month: '2-digit', year: 'numeric',
    hour: '2-digit', minute: '2-digit'
  })
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
const fetchOrders = async () => {
  loading.value = true
  try {
    const res = await fetch('/api/orders/')
    if (res.ok) {
      orders.value = await res.json()
    }
  } catch (err) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", err)
  } finally {
    loading.value = false
  }
}

// –í—ñ–¥–∫—Ä–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ
const openDetails = (order) => {
  selectedOrder.value = order
  showDetailModal.value = true
}

onMounted(() => {
  fetchOrders()
})
</script>

<template>
  <div class="p-8 h-screen overflow-y-auto bg-gray-50 ml-64 custom-scrollbar">
    
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-bold text-gray-800">üìä –Ü—Å—Ç–æ—Ä—ñ—è –ø—Ä–æ–¥–∞–∂—ñ–≤</h2>
        <p class="text-gray-500">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</p>
      </div>
      <button @click="fetchOrders" class="text-blue-600 hover:bg-blue-50 p-2 rounded-full transition">
        <i class="fas fa-sync-alt" :class="{'fa-spin': loading}"></i>
      </button>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      <table class="w-full text-left">
        <thead class="bg-gray-100 text-gray-500 uppercase text-xs">
          <tr>
            <th class="p-4">ID / –ß–∞—Å</th>
            <th class="p-4">–ö–ª—ñ—î–Ω—Ç</th> <th class="p-4">–¢–æ–≤–∞—Ä–∏ (–ö–æ—Ä–æ—Ç–∫–æ)</th>
            <th class="p-4">–û–ø–ª–∞—Ç–∞</th>
            <th class="p-4 text-right">–°—É–º–∞</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <tr v-if="orders.length === 0" class="text-center text-gray-400">
            <td colspan="5" class="p-8">–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å –ø–æ—Ä–æ–∂–Ω—è</td>
          </tr>

          <tr v-for="order in orders" :key="order.id" 
              @click="openDetails(order)"
              class="hover:bg-blue-50 transition cursor-pointer group">
            
            <td class="p-4">
              <div class="font-bold text-gray-800 group-hover:text-blue-600 transition">#{{ order.id }}</div>
              <div class="text-sm text-gray-500">{{ formatDate(order.created_at) }}</div>
            </td>

            <td class="p-4">
                <div v-if="order.customer">
                    <div class="font-bold text-gray-700">{{ order.customer.name }}</div>
                    <div class="text-xs text-gray-400">{{ order.customer.phone }}</div>
                </div>
                <div v-else class="text-gray-400 text-sm italic">–ì—ñ—Å—Ç—å</div>
            </td>

            <td class="p-4">
              <div class="text-sm text-gray-600">
                 {{ order.items.length }} –ø–æ–∑–∏—Ü—ñ–π
                 <span class="text-xs text-gray-400">({{ order.items[0]?.product_name }}...)</span>
              </div>
            </td>

            <td class="p-4">
              <span v-if="order.payment_method === 'card'" class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold">
                <i class="fas fa-credit-card mr-1"></i> –ö–∞—Ä—Ç–∫–∞
              </span>
              <span v-else class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-bold">
                <i class="fas fa-money-bill-wave mr-1"></i> –ì–æ—Ç—ñ–≤–∫–∞
              </span>
            </td>

            <td class="p-4 text-right font-mono font-bold text-lg text-gray-800">
              {{ order.total_price }} ‚Ç¥
            </td>

          </tr>
        </tbody>
      </table>
    </div>

    <div v-if="showDetailModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative overflow-hidden flex flex-col max-h-[90vh]">
            
            <div class="p-6 bg-gray-50 border-b flex justify-between items-start">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">–ß–µ–∫ #{{ selectedOrder.id }}</h3>
                    <p class="text-gray-500 text-sm">{{ formatDate(selectedOrder.created_at) }}</p>
                </div>
                <button @click="showDetailModal = false" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto">
                
                <div class="mb-6 bg-blue-50 p-4 rounded-xl border border-blue-100 flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-200 text-blue-600 flex items-center justify-center text-lg">
                        <i class="fas" :class="selectedOrder.customer ? 'fa-user' : 'fa-user-secret'"></i>
                    </div>
                    <div>
                        <div class="text-xs font-bold text-blue-400 uppercase">–ü–æ–∫—É–ø–µ—Ü—å</div>
                        <div class="font-bold text-gray-800 text-lg">
                            {{ selectedOrder.customer ? selectedOrder.customer.name : '–ì—ñ—Å—Ç—å' }}
                        </div>
                        <div v-if="selectedOrder.customer" class="text-sm text-gray-600">
                            {{ selectedOrder.customer.phone }}
                        </div>
                    </div>
                </div>

                <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">–¢–æ–≤–∞—Ä–∏</h4>
                <div class="space-y-3">
                    <div v-for="item in selectedOrder.items" :key="item.id" class="flex justify-between items-center text-sm">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-gray-800">{{ item.product_name }}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="text-gray-500">x{{ item.quantity }}</span>
                            <span class="font-mono font-bold">{{ item.price_at_moment * item.quantity }} ‚Ç¥</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="p-6 bg-gray-50 border-t">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-500">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç–∏:</span>
                    <span class="font-bold uppercase text-sm" 
                          :class="selectedOrder.payment_method === 'card' ? 'text-blue-600' : 'text-green-600'">
                        {{ selectedOrder.payment_method === 'card' ? '–ë–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –∫–∞—Ä—Ç–∫–∞' : '–ì–æ—Ç—ñ–≤–∫–∞' }}
                    </span>
                </div>
                <div class="flex justify-between items-center text-3xl font-bold text-gray-900 mt-2">
                    <span>–†–∞–∑–æ–º:</span>
                    <span>{{ selectedOrder.total_price }} ‚Ç¥</span>
                </div>
            </div>

        </div>
    </div>

  </div>
</template>

========================================
FILE: frontend/src/components/Customers.vue
========================================
<script setup>
import { ref, onMounted, watch } from 'vue'

const customers = ref([])
const loading = ref(false)
const searchQuery = ref('')
const showModal = ref(false)
const isEditing = ref(false)
const editingId = ref(null)

// --- –ù–û–í–ï: –ó–ú–Ü–ù–ù–Ü –î–õ–Ø –Ü–°–¢–û–†–Ü–á ---
const showHistoryModal = ref(false)
const historyLoading = ref(false)
const currentCustomerHistory = ref(null) // –ö–ª—ñ—î–Ω—Ç, —á–∏—é —ñ—Å—Ç–æ—Ä—ñ—é –¥–∏–≤–∏–º–æ—Å—å
const customerOrders = ref([]) // –°–ø–∏—Å–æ–∫ –π–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å

// –§–æ—Ä–º–∞
const formData = ref({
  name: '',
  phone: '',
  email: '',
  notes: ''
})

// –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('uk-UA', {
    day: '2-digit', month: '2-digit', year: 'numeric',
    hour: '2-digit', minute: '2-digit'
  })
}

// --- API –ó–ê–ü–ò–¢–ò (CRUD) ---
const fetchCustomers = async () => {
  loading.value = true
  try {
    let url = '/api/customers/'
    if (searchQuery.value.length > 0) url = `/api/customers/search/?q=${searchQuery.value}`
    const res = await fetch(url)
    if (res.ok) customers.value = await res.json()
  } catch (err) { console.error(err) } finally { loading.value = false }
}

const openCreateModal = () => {
  isEditing.value = false
  formData.value = { name: '', phone: '', email: '', notes: '' }
  showModal.value = true
}

const openEditModal = (customer) => {
  isEditing.value = true
  editingId.value = customer.id
  formData.value = { name: customer.name, phone: customer.phone, email: customer.email, notes: customer.notes }
  showModal.value = true
}

const saveCustomer = async () => {
  if (!formData.value.name || !formData.value.phone) return alert("–Ü–º'—è —Ç–∞ –¢–µ–ª–µ—Ñ–æ–Ω –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ!")
  try {
    let url = '/api/customers/'
    let method = 'POST'
    if (isEditing.value) {
      url = `/api/customers/${editingId.value}`
      method = 'PUT'
    }
    const res = await fetch(url, {
      method: method,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData.value)
    })
    if (res.ok) {
      showModal.value = false
      fetchCustomers()
      alert(isEditing.value ? "–ö–ª—ñ—î–Ω—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ!" : "–ö–ª—ñ—î–Ω—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ!")
    } else {
      const err = await res.json()
      alert("–ü–æ–º–∏–ª–∫–∞: " + (err.detail || "–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏"))
    }
  } catch (err) { console.error(err) }
}

const deleteCustomer = async (id) => {
  if (!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –∑ –±–∞–∑–∏?")) return
  await fetch(`/api/customers/${id}`, { method: 'DELETE' })
  fetchCustomers()
}

// --- –ù–û–í–ï: –õ–û–ì–Ü–ö–ê –Ü–°–¢–û–†–Ü–á ---
const openHistory = async (customer) => {
  currentCustomerHistory.value = customer
  customerOrders.value = []
  showHistoryModal.value = true
  historyLoading.value = true
  
  try {
    const res = await fetch(`/api/customers/${customer.id}/orders/`)
    if (res.ok) {
      customerOrders.value = await res.json()
    }
  } catch (err) {
    console.error(err)
    alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é")
  } finally {
    historyLoading.value = false
  }
}

let timeout = null
watch(searchQuery, () => {
  clearTimeout(timeout)
  timeout = setTimeout(() => { fetchCustomers() }, 500)
})

onMounted(() => {
  fetchCustomers()
})
</script>

<template>
  <div class="p-8 h-screen overflow-y-auto bg-gray-50 ml-64 custom-scrollbar">
    
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-bold text-gray-800">üë• –ö–ª—ñ—î–Ω—Ç–∏ (CRM)</h2>
        <p class="text-gray-500">–ë–∞–∑–∞ –ø–æ—Å—Ç—ñ–π–Ω–∏—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤</p>
      </div>
      <button @click="openCreateModal" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg flex items-center gap-2">
        <i class="fas fa-user-plus"></i> –î–æ–¥–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞
      </button>
    </div>

    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6 flex gap-4 items-center">
      <i class="fas fa-search text-gray-400 text-xl ml-2"></i>
      <input v-model="searchQuery" type="text" placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º'—è–º –∞–±–æ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º..." class="w-full text-lg outline-none text-gray-700 placeholder-gray-400">
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
      <table class="w-full text-left">
        <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
          <tr>
            <th class="p-4">–Ü–º'—è</th>
            <th class="p-4">–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th class="p-4">Email / –ù–æ—Ç–∞—Ç–∫–∏</th>
            <th class="p-4 text-center">–î—ñ—ó</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <tr v-if="customers.length === 0" class="text-center text-gray-400">
            <td colspan="4" class="p-8">
                <span v-if="loading"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
                <span v-else>–ö–ª—ñ—î–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</span>
            </td>
          </tr>

          <tr v-for="c in customers" :key="c.id" class="hover:bg-blue-50 transition group">
            <td class="p-4 font-bold text-gray-800">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">
                        {{ c.name.charAt(0) }}
                    </div>
                    {{ c.name }}
                </div>
            </td>
            <td class="p-4 font-mono text-gray-600">{{ c.phone }}</td>
            <td class="p-4 text-sm text-gray-500">
                <div v-if="c.email">{{ c.email }}</div>
                <div v-if="c.notes" class="italic text-xs mt-1">"{{ c.notes }}"</div>
            </td>
            <td class="p-4 text-center flex justify-center gap-2">
                <button @click="openHistory(c)" class="text-purple-400 hover:text-purple-600 transition px-2" title="–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫—É–ø–æ–∫">
                    <i class="fas fa-history"></i>
                </button>
                <button @click="openEditModal(c)" class="text-gray-400 hover:text-blue-500 transition px-2" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">
                    <i class="fas fa-pen"></i>
                </button>
                <button @click="deleteCustomer(c.id)" class="text-gray-400 hover:text-red-500 transition px-2" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div v-if="showModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative">
            <button @click="showModal = false" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-xl font-bold mb-4">{{ isEditing ? '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞' : '–ù–æ–≤–∏–π –∫–ª—ñ—î–Ω—Ç' }}</h3>
            <div class="space-y-4">
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–Ü–º'—è *</label><input v-model="formData.name" class="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–¢–µ–ª–µ—Ñ–æ–Ω *</label><input v-model="formData.phone" class="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white outline-none"></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Email</label><input v-model="formData.email" class="w-full border p-3 rounded-lg bg-gray-50"></div>
                <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ù–æ—Ç–∞—Ç–∫–∏</label><textarea v-model="formData.notes" class="w-full border p-3 rounded-lg bg-gray-50" rows="2"></textarea></div>
                <button @click="saveCustomer" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition mt-2">{{ isEditing ? '–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏' : '–°—Ç–≤–æ—Ä–∏—Ç–∏' }}</button>
            </div>
        </div>
    </div>

    <div v-if="showHistoryModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col relative overflow-hidden">
            <div class="p-6 border-b bg-gray-50 flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-gray-800">–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫—É–ø–æ–∫</h3>
                    <p class="text-gray-500" v-if="currentCustomerHistory">{{ currentCustomerHistory.name }} ({{ currentCustomerHistory.phone }})</p>
                </div>
                <button @click="showHistoryModal = false" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-2xl"></i></button>
            </div>

            <div class="flex-1 overflow-y-auto p-0">
                <div v-if="historyLoading" class="flex justify-center items-center h-40 text-gray-400">
                    <i class="fas fa-spinner fa-spin text-2xl"></i>
                </div>
                
                <div v-else-if="customerOrders.length === 0" class="flex flex-col justify-center items-center h-64 text-gray-400">
                    <i class="fas fa-shopping-bag text-5xl mb-4 opacity-20"></i>
                    <p>–¶–µ–π –∫–ª—ñ—î–Ω—Ç —â–µ –Ω—ñ—á–æ–≥–æ –Ω–µ –∫—É–ø—É–≤–∞–≤</p>
                </div>

                <table v-else class="w-full text-left">
                    <thead class="bg-gray-100 text-gray-500 uppercase text-xs sticky top-0">
                        <tr>
                            <th class="p-4">–î–∞—Ç–∞</th>
                            <th class="p-4">–¢–æ–≤–∞—Ä–∏</th>
                            <th class="p-4 text-right">–°—É–º–∞</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr v-for="order in customerOrders" :key="order.id" class="hover:bg-gray-50">
                            <td class="p-4 text-sm whitespace-nowrap">
                                <div class="font-bold text-gray-800">{{ formatDate(order.created_at).split(',')[0] }}</div>
                                <div class="text-xs text-gray-500">{{ formatDate(order.created_at).split(',')[1] }}</div>
                                <span class="text-[10px] px-1.5 py-0.5 rounded border" 
                                      :class="order.payment_method==='card' ? 'text-blue-600 border-blue-200 bg-blue-50' : 'text-green-600 border-green-200 bg-green-50'">
                                    {{ order.payment_method === 'card' ? '–ö–∞—Ä—Ç–∫–∞' : '–ì–æ—Ç—ñ–≤–∫–∞' }}
                                </span>
                            </td>
                            <td class="p-4">
                                <ul class="text-sm">
                                    <li v-for="item in order.items" :key="item.id" class="flex justify-between w-full max-w-[200px]">
                                        <span>{{ item.product_name }}</span>
                                        <span class="text-gray-400 ml-2">x{{ item.quantity }}</span>
                                    </li>
                                </ul>
                            </td>
                            <td class="p-4 text-right font-bold font-mono text-gray-700">
                                {{ order.total_price }} ‚Ç¥
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="p-4 border-t bg-gray-50 text-right text-sm text-gray-500">
                –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: <b>{{ customerOrders.length }}</b>
            </div>
        </div>
    </div>

  </div>
</template>

========================================
FILE: frontend/src/components/ProductModal.vue
========================================
<script setup>
import { ref, computed, watch } from 'vue'

const props = defineProps({
  isOpen: Boolean,
  product: Object 
})

const emit = defineEmits(['close', 'add-to-cart'])

const selectedVariant = ref(null)
const selectedModifiers = ref({}) 

// --- –í–ò–ü–†–ê–í–õ–ï–ù–û: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –í–Ü–î–ö–†–ò–¢–¢–Ü –≤—ñ–∫–Ω–∞ ---
watch(() => props.isOpen, (isOpen) => {
  if (isOpen && props.product) {
    // 1. –°–∫–∏–¥–∞—î–º–æ –≤–∏–±—ñ—Ä
    selectedVariant.value = null
    selectedModifiers.value = {}

    // 2. –Ø–∫—â–æ —î –≤–∞—Ä—ñ–∞–Ω—Ç–∏, –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –≤–∏–±–∏—Ä–∞—î–º–æ –ø–µ—Ä—à–∏–π (—Ü–µ –≤–∏–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É "–Ω—ñ—á–æ–≥–æ –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è")
    if (props.product.variants && props.product.variants.length > 0) {
      // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ —Ü—ñ–Ω–æ—é, —â–æ–± –≤–∏–±—Ä–∞—Ç–∏ –Ω–∞–π–¥–µ—à–µ–≤—à–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –∞–±–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä—à–∏–π
      const sorted = [...props.product.variants].sort((a, b) => a.price - b.price)
      selectedVariant.value = sorted[0]
    }

    // 3. –í–∏–±–∏—Ä–∞—î–º–æ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏
    if (props.product.modifier_groups) {
      props.product.modifier_groups.forEach(group => {
        if (group.is_required && group.modifiers.length > 0) {
          selectedModifiers.value[group.id] = group.modifiers[0].id
        }
      })
    }
  }
})

const currentPrice = computed(() => {
  if (!props.product) return 0
  let price = 0
  
  if (props.product.has_variants && selectedVariant.value) {
    price += selectedVariant.value.price
  } else {
    price += props.product.price
  }
  
  if (props.product.modifier_groups) {
    props.product.modifier_groups.forEach(group => {
      const modId = selectedModifiers.value[group.id]
      if (modId) {
        const mod = group.modifiers.find(m => m.id === modId)
        if (mod) price += mod.price_change
      }
    })
  }
  
  return price
})

const handleAddToCart = () => {
  // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —è–∫—â–æ —Ü–µ —Ç–æ–≤–∞—Ä –∑ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏, –∞–ª–µ –≤–∞—Ä—ñ–∞–Ω—Ç –Ω–µ –æ–±—Ä–∞–Ω–æ (—Ö–æ—á–∞ watch –º–∞—î —Ü–µ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏)
  if (props.product.has_variants && !selectedVariant.value) {
      alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä/–≤–∞—Ä—ñ–∞–Ω—Ç")
      return
  }

  const payload = {
    product: props.product,
    variant_id: selectedVariant.value ? selectedVariant.value.id : null,
    modifiers: Object.values(selectedModifiers.value).map(id => ({ modifier_id: id })),
    finalPrice: currentPrice.value,
    generatedName: generateName() 
  }
  emit('add-to-cart', payload)
  emit('close')
}

const generateName = () => {
  let name = props.product.name
  if (selectedVariant.value) {
    name += ` (${selectedVariant.value.name})`
  }
  return name
}
</script>

<template>
  <div v-if="isOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="emit('close')"></div>

    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative overflow-hidden flex flex-col max-h-[90vh] animate-fade-in-up">
      
      <div class="p-6 bg-gray-50 border-b flex justify-between items-start">
        <div>
           <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">
             {{ product.category?.name || '–¢–æ–≤–∞—Ä' }}
           </div>
           <h2 class="text-3xl font-bold text-gray-800 leading-none">{{ product.name }}</h2>
        </div>
        <button @click="emit('close')" class="text-gray-400 hover:text-gray-600 bg-white p-2 rounded-full shadow-sm hover:shadow transition">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>

      <div class="p-6 overflow-y-auto space-y-6">
        
        <div v-if="product.has_variants && product.variants.length > 0">
          <label class="block text-sm font-bold text-gray-900 mb-3">–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä/–≤–∞–≥—É:</label>
          <div class="grid grid-cols-3 gap-3">
            <button 
              v-for="variant in product.variants" 
              :key="variant.id"
              @click="selectedVariant = variant"
              class="py-3 px-2 rounded-xl border-2 transition-all flex flex-col items-center justify-center gap-1"
              :class="selectedVariant?.id === variant.id ? 'border-purple-600 bg-purple-50 text-purple-700' : 'border-gray-200 hover:border-gray-300 text-gray-600'"
            >
              <span class="font-bold">{{ variant.name }}</span>
              <span class="text-xs">{{ variant.price }} ‚Ç¥</span>
            </button>
          </div>
        </div>

        <div v-if="product.modifier_groups && product.modifier_groups.length > 0" class="space-y-4">
          <div v-for="group in product.modifier_groups" :key="group.id" class="bg-gray-50 p-4 rounded-xl border border-gray-100">
            <label class="block text-sm font-bold text-gray-700 mb-2">
              {{ group.name }} <span v-if="!group.is_required" class="text-gray-400 font-normal text-xs">(–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</span>
            </label>
            
            <div class="flex flex-wrap gap-2">
              <button 
                v-for="mod in group.modifiers" 
                :key="mod.id"
                @click="selectedModifiers[group.id] = mod.id"
                class="px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm border"
                :class="selectedModifiers[group.id] === mod.id ? 'bg-gray-800 text-white border-gray-800' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-100'"
              >
                {{ mod.name }}
                <span v-if="mod.price_change > 0" class="text-xs opacity-70 ml-1">+{{ mod.price_change }}</span>
              </button>
            </div>
          </div>
        </div>

      </div>

      <div class="p-6 border-t bg-gray-50 flex justify-between items-center">
        <div class="text-2xl font-bold text-gray-900">
          {{ currentPrice }} ‚Ç¥
        </div>
        <button 
          @click="handleAddToCart"
          class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-purple-700 transition shadow-lg shadow-purple-200 active:scale-95 flex items-center gap-2"
        >
          <i class="fas fa-cart-plus"></i> –î–æ–¥–∞—Ç–∏
        </button>
      </div>

    </div>
  </div>
</template>

<style scoped>
.animate-fade-in-up {
  animation: fadeInUp 0.3s ease-out;
}
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
</style>

========================================
FILE: frontend/src/components/Sidebar.vue
========================================
<script setup>
// –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∞–∫—Ç–∏–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—ñ–¥ –±–∞—Ç—å–∫–∞
defineProps({
  currentPage: String 
})

const emit = defineEmits(['change-page'])
</script>

<template>
  <aside class="w-64 bg-gray-900 text-white flex flex-col h-screen fixed left-0 top-0 border-r border-gray-800 z-50">
    
    <div class="p-6 text-2xl font-bold text-center border-b border-gray-800 flex items-center justify-center gap-2">
      <div class="w-8 h-8 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-full"></div>
      HITS POS
    </div>

    <nav class="flex-1 py-6 space-y-1">
      
      <a href="#" 
         @click.prevent="emit('change-page', 'pos')"
         :class="currentPage === 'pos' ? 'bg-gray-800 text-yellow-400 border-l-4 border-yellow-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all">
        <i class="fas fa-cash-register w-6 text-center mr-2"></i> 
        –ö–∞—Å–∞
      </a>
      
      <a href="#" 
         @click.prevent="emit('change-page', 'warehouse')"
         :class="currentPage === 'warehouse' ? 'bg-gray-800 text-blue-400 border-l-4 border-blue-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all group">
        <i class="fas fa-boxes w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 
        –°–∫–ª–∞–¥
      </a>
      
      <a href="#" 
         @click.prevent="emit('change-page', 'customers')"
         :class="currentPage === 'customers' ? 'bg-gray-800 text-green-400 border-l-4 border-green-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all group">
        <i class="fas fa-users w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 
        –ö–ª—ñ—î–Ω—Ç–∏
      </a>

      <a href="#" 
         @click.prevent="emit('change-page', 'statistics')"
         :class="currentPage === 'statistics' ? 'bg-gray-800 text-purple-400 border-l-4 border-purple-400' : 'text-gray-400 hover:bg-gray-800 hover:text-white'"
         class="flex items-center px-6 py-3 font-bold transition-all group">
        <i class="fas fa-chart-line w-6 text-center mr-2 group-hover:scale-110 transition-transform"></i> 
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      </a>
    </nav>

    <div class="p-4 border-t border-gray-800 text-xs text-gray-500 text-center">
      <p>Server: <span class="text-green-500">Online üü¢</span></p>
    </div>
  </aside>
</template>

========================================
FILE: frontend/src/components/CartDrawer.vue
========================================
<script setup>
import { computed, ref, watch } from 'vue'

const props = defineProps({
  isOpen: Boolean,
  products: Array 
})

const emit = defineEmits(['close', 'clear-cart'])
const cartItems = ref([])
const isProcessing = ref(false)
const paymentMethod = ref('cash')

// --- CRM ---
const customerSearch = ref('')
const customerResults = ref([])
const selectedCustomer = ref(null)

const searchCustomer = async () => {
  if (customerSearch.value.length < 2) { customerResults.value = []; return }
  try {
    const res = await fetch(`/api/customers/search/?q=${customerSearch.value}`)
    if (res.ok) customerResults.value = await res.json()
  } catch (err) { console.error(err) }
}
const selectCustomer = (c) => { selectedCustomer.value = c; customerSearch.value = ''; customerResults.value = [] }
const removeCustomer = () => { selectedCustomer.value = null }

// --- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø ---
const loadCart = async () => {
  try {
    const res = await fetch('/api/cart/')
    if (res.ok) {
        const items = await res.json()
        // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –Ω–∞–∑–≤–æ—é, —â–æ–± —Å–ø–∏—Å–æ–∫ –Ω–µ —Å—Ç—Ä–∏–±–∞–≤
        cartItems.value = items.sort((a, b) => a.name.localeCompare(b.name))
    }
  } catch (err) { console.error("–ü–æ–º–∏–ª–∫–∞ –∫–æ—à–∏–∫–∞:", err) }
}

// --- –í–ê–ñ–õ–ò–í–û: –î–æ–∑–≤–æ–ª—è—î–º–æ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ü—é —Ñ—É–Ω–∫—Ü—ñ—é ---
defineExpose({
  loadCart
})

// --- –£–ü–†–ê–í–õ–Ü–ù–ù–Ø ---
const changeQty = async (cartItemId, change) => {
    await fetch(`/api/cart/${cartItemId}/update?change=${change}`, { method: 'POST' })
    await loadCart()
    // –ï–º—ñ—Ç–∏–º–æ –ø–æ–¥—ñ—é, —â–æ–± –æ–Ω–æ–≤–∏—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫ —É —à–∞–ø—Ü—ñ App.vue
    emit('clear-cart') // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —ñ—Å–Ω—É—é—á–∏–π emit –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
}

const removeItem = async (cartItemId) => {
  if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä?')) return
  await fetch(`/api/cart/${cartItemId}`, { method: 'DELETE' })
  await loadCart()
  emit('clear-cart')
}

const clearAll = async () => {
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –∫–æ—à–∏–∫?')) return
  await fetch('/api/cart/', { method: 'DELETE' })
  await loadCart()
  emit('clear-cart')
}

// --- –û–ü–õ–ê–¢–ê ---
const totalSum = computed(() => {
  return cartItems.value.reduce((sum, item) => sum + (item.price * item.quantity), 0)
})

const checkout = async () => {
  if (cartItems.value.length === 0) return
  isProcessing.value = true

  try {
    const payload = {
      items: cartItems.value.map(item => ({
        product_id: item.product_id,
        variant_id: item.variant_id,
        modifiers: item.modifiers,
        quantity: item.quantity
      })),
      payment_method: paymentMethod.value,
      total_price: totalSum.value,
      customer_id: selectedCustomer.value ? selectedCustomer.value.id : null
    }

    const res = await fetch('/api/orders/checkout/', { 
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })

    if (!res.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ —Å–ø–∏—Å–∞–Ω–Ω—è")

    await fetch('/api/cart/', { method: 'DELETE' })
    
    let msg = `‚úÖ –û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞!\n–°—É–º–∞: ${totalSum.value} ‚Ç¥`
    if (selectedCustomer.value) msg += `\n–ö–ª—ñ—î–Ω—Ç: ${selectedCustomer.value.name}`
    alert(msg)
    
    selectedCustomer.value = null
    emit('clear-cart')
    emit('close')
    
  } catch (err) {
    alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç—ñ!")
    console.error(err)
  } finally {
    isProcessing.value = false
  }
}

watch(() => props.isOpen, (newVal) => { if (newVal) loadCart() })
</script>

<template>
  <div class="fixed inset-0 z-50 flex justify-end transition-opacity duration-300" 
       :class="isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'">
    
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" @click="emit('close')"></div>

    <div class="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col transition-transform duration-300 transform"
         :class="isOpen ? 'translate-x-0' : 'translate-x-full'">
      
      <div class="p-5 bg-gray-900 text-white flex justify-between items-center shadow-md">
        <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-shopping-cart"></i> –ö–æ—à–∏–∫</h2>
        <div class="flex gap-3">
            <button @click="clearAll" class="text-gray-400 hover:text-red-400 transition" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ"><i class="fas fa-trash-alt"></i></button>
            <button @click="emit('close')" class="text-gray-400 hover:text-white transition"><i class="fas fa-times text-xl"></i></button>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto p-4 bg-gray-50 custom-scrollbar">
        <div v-if="cartItems.length === 0" class="flex flex-col items-center justify-center h-full text-gray-400">
          <i class="fas fa-shopping-basket text-6xl mb-4 opacity-20"></i>
          <p>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
        </div>

        <div v-else class="space-y-3">
          <div v-for="item in cartItems" :key="item.cart_item_id" 
               class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3">
            
            <div class="flex justify-between items-start">
              <span class="font-bold text-gray-800 text-lg leading-tight">{{ item.name }}</span>
              <span class="font-mono font-bold text-gray-900 whitespace-nowrap">{{ (item.price * item.quantity).toFixed(2) }} ‚Ç¥</span>
            </div>

            <div class="flex justify-between items-center bg-gray-50 rounded-lg p-1">
                <div class="flex items-center gap-3">
                    <button @click="changeQty(item.cart_item_id, -1)" 
                            class="w-8 h-8 rounded-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-100 flex items-center justify-center font-bold shadow-sm active:scale-95">-</button>
                    <span class="w-6 text-center font-bold text-gray-800">{{ item.quantity }}</span>
                    <button @click="changeQty(item.cart_item_id, 1)" 
                            class="w-8 h-8 rounded-full bg-gray-800 text-white hover:bg-gray-700 flex items-center justify-center font-bold shadow-sm active:scale-95">+</button>
                </div>
                
                <button @click="removeItem(item.cart_item_id)" class="text-red-400 hover:text-red-600 p-2">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
          </div>
        </div>
      </div>

      <div class="p-6 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
        <div class="mb-4">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">–ö–ª—ñ—î–Ω—Ç</label>
            <div v-if="!selectedCustomer" class="relative">
                <div class="flex items-center border rounded-lg bg-gray-50 overflow-hidden">
                    <i class="fas fa-search text-gray-400 ml-3"></i>
                    <input v-model="customerSearch" @input="searchCustomer" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∞–±–æ —ñ–º'—è..." class="w-full p-2 bg-transparent outline-none text-sm">
                </div>
                <div v-if="customerResults.length > 0" class="absolute bottom-full left-0 w-full bg-white border shadow-xl rounded-lg mb-1 max-h-40 overflow-y-auto z-10">
                    <div v-for="c in customerResults" :key="c.id" @click="selectCustomer(c)" class="p-2 hover:bg-blue-50 cursor-pointer border-b flex justify-between items-center">
                         <div><div class="font-bold text-sm">{{ c.name }}</div><div class="text-xs text-gray-500">{{ c.phone }}</div></div>
                         <i class="fas fa-plus-circle text-blue-500"></i>
                    </div>
                </div>
            </div>
            <div v-else class="flex justify-between items-center bg-blue-50 border border-blue-200 p-2 rounded-lg">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-xs font-bold">{{ selectedCustomer.name.charAt(0) }}</div>
                    <div><div class="font-bold text-sm text-blue-900">{{ selectedCustomer.name }}</div><div class="text-xs text-blue-600">{{ selectedCustomer.phone }}</div></div>
                </div>
                <button @click="removeCustomer" class="text-gray-400 hover:text-red-500 px-2"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <div class="mb-4">
            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">–û–ø–ª–∞—Ç–∞</label>
            <div class="grid grid-cols-2 gap-3">
                <button @click="paymentMethod = 'cash'" class="py-2 px-4 rounded-lg border-2 flex items-center justify-center gap-2 transition-all" :class="paymentMethod === 'cash' ? 'border-green-500 bg-green-50 text-green-700 font-bold' : 'border-gray-200 text-gray-500'"> <i class="fas fa-money-bill-wave"></i> –ì–æ—Ç—ñ–≤–∫–∞ </button>
                <button @click="paymentMethod = 'card'" class="py-2 px-4 rounded-lg border-2 flex items-center justify-center gap-2 transition-all" :class="paymentMethod === 'card' ? 'border-blue-500 bg-blue-50 text-blue-700 font-bold' : 'border-gray-200 text-gray-500'"> <i class="fas fa-credit-card"></i> –ö–∞—Ä—Ç–∫–∞ </button>
            </div>
        </div>

        <div class="flex justify-between items-center text-2xl font-bold mb-4 text-gray-800">
          <span>–†–∞–∑–æ–º:</span><span>{{ totalSum.toFixed(2) }} ‚Ç¥</span>
        </div>
        
        <button @click="checkout" :disabled="cartItems.length === 0 || isProcessing" class="w-full py-4 rounded-xl font-bold text-lg text-white transition shadow-lg flex justify-center items-center gap-2 disabled:bg-gray-400" :class="paymentMethod === 'cash' ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'">
          <span v-if="isProcessing"><i class="fas fa-spinner fa-spin"></i> –û–±—Ä–æ–±–∫–∞...</span>
          <span v-else>–û–ø–ª–∞—Ç–∏—Ç–∏</span>
        </button>
      </div>
    </div>
  </div>
</template>

========================================
FILE: frontend/src/components/IngredientSelect.vue
========================================
<script setup>
import { ref, computed, watch, onMounted, onUnmounted } from 'vue'

const props = defineProps({
  modelValue: [String, Number], // –¶–µ ID –æ–±—Ä–∞–Ω–æ–≥–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞ (v-model)
  ingredients: { type: Array, default: () => [] },
  placeholder: { type: String, default: '–û–±–µ—Ä—ñ—Ç—å —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç...' }
})

const emit = defineEmits(['update:modelValue'])

const isOpen = ref(false)
const searchQuery = ref('')
const containerRef = ref(null)

// –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–∑–≤—É –æ–±—Ä–∞–Ω–æ–≥–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞ –ø–æ ID
const selectedName = computed(() => {
  if (!props.modelValue) return ''
  const found = props.ingredients.find(i => i.id === props.modelValue)
  return found ? found.name : ''
})

// –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Å–ø–∏—Å–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ—à—É–∫—É
const filteredList = computed(() => {
  if (!searchQuery.value) return props.ingredients
  const lower = searchQuery.value.toLowerCase()
  return props.ingredients.filter(i => i.name.toLowerCase().includes(lower))
})

const toggleDropdown = () => {
  isOpen.value = !isOpen.value
  if (isOpen.value) {
    // –ü—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ—à—É–∫ —ñ –æ—á–∏—Å—Ç–∫–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–æ—à—É–∫—É
    searchQuery.value = ''
  }
}

const selectItem = (id) => {
  emit('update:modelValue', id)
  isOpen.value = false
}

// –ó–∞–∫—Ä–∏—Ç—Ç—è –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –µ–ª–µ–º–µ–Ω—Ç–æ–º
const handleClickOutside = (event) => {
  if (containerRef.value && !containerRef.value.contains(event.target)) {
    isOpen.value = false
  }
}

onMounted(() => { document.addEventListener('click', handleClickOutside) })
onUnmounted(() => { document.removeEventListener('click', handleClickOutside) })
</script>

<template>
  <div class="relative w-full" ref="containerRef">
    <div 
      @click="toggleDropdown"
      class="border rounded bg-white flex items-center justify-between cursor-pointer px-2 py-1.5 min-h-[38px] transition-colors hover:border-purple-300"
      :class="isOpen ? 'border-purple-500 ring-1 ring-purple-200' : 'border-gray-200'"
    >
      <span v-if="selectedName" class="text-sm text-gray-800 font-medium truncate">{{ selectedName }}</span>
      <span v-else class="text-sm text-gray-400 truncate">{{ placeholder }}</span>
      
      <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform duration-200" :class="{'rotate-180': isOpen}"></i>
    </div>

    <div v-if="isOpen" class="absolute z-50 mt-1 w-full bg-white border border-gray-200 rounded-lg shadow-xl max-h-60 overflow-hidden flex flex-col animate-fade-in-down">
      
      <div class="p-2 border-b bg-gray-50">
        <input 
          v-model="searchQuery" 
          ref="searchInput"
          class="w-full text-sm border border-gray-300 rounded px-2 py-1 outline-none focus:border-purple-500"
          placeholder="–ü–æ—à—É–∫..." 
          @click.stop
        >
      </div>

      <div class="overflow-y-auto custom-scrollbar flex-1">
        <div v-if="filteredList.length === 0" class="p-3 text-xs text-gray-400 text-center">
          –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
        </div>
        
        <div 
          v-for="item in filteredList" 
          :key="item.id"
          @click="selectItem(item.id)"
          class="px-3 py-2 text-sm cursor-pointer hover:bg-purple-50 transition-colors flex justify-between items-center group"
          :class="item.id === modelValue ? 'bg-purple-50 text-purple-700 font-bold' : 'text-gray-700'"
        >
          <span>{{ item.name }}</span>
          <span class="text-[10px] text-gray-400 group-hover:text-purple-400 bg-gray-100 group-hover:bg-white px-1 rounded">
             {{ item.stock_quantity }} {{ item.unit?.symbol }}
          </span>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.animate-fade-in-down {
  animation: fadeInDown 0.2s ease-out;
}
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

========================================
FILE: nginx/nginx.conf
========================================
events {}

http {
    include       /etc/nginx/mime.types; # –í–∞–∂–ª–∏–≤–æ –¥–ª—è —Å—Ç–∏–ª—ñ–≤ CSS —Ç–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        # 1. –§–†–û–ù–¢–ï–ù–î (Vue)
        location / {
            root /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ /index.html;
        }

        # 2. API –ö–û–®–ò–ö–ê (Order Service)
        # –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ /api/cart/...
        location /api/cart/ {
            # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api/cart/ —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –∑–∞–ª–∏—à–æ–∫ –Ω–∞ –±–µ–∫–µ–Ω–¥
            # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: /api/cart/ -> http://order_service:8000/cart/
            proxy_pass http://order_service:8000/cart/;
        }

        # 3. –í–°–Ü –Ü–ù–®–Ü API (Product Service)
        # –¶–µ "catch-all" –±–ª–æ–∫. –°—é–¥–∏ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç—å:
        # /api/products/, /api/categories/, /api/inventory/, /api/ingredients/
        location /api/ {
            # –í—ñ–¥—Ä—ñ–∑–∞—î–º–æ /api —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –∫–æ—Ä—ñ–Ω—å
            # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: /api/inventory/deduct/ -> http://product_service:8000/inventory/deduct/
            rewrite ^/api/(.*) /$1 break;
            proxy_pass http://product_service:8000;
        }
    }
}

========================================
FILE: product_service/requirements.txt
========================================
fastapi
uvicorn
sqlalchemy
psycopg2-binary
pydantic


========================================
FILE: product_service/schemas.py
========================================
# ========================================
# FILE: product_service/schemas.py
# ========================================
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

# --- 1. CATEGORIES (–û–ù–û–í–õ–ï–ù–û) ---
class CategoryBase(BaseModel):
    name: str
    slug: str
    color: Optional[str] = "#ffffff" # –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –±—ñ–ª–∏–π
    parent_id: Optional[int] = None # –ú–æ–∂–µ –±—É—Ç–∏ None (—è–∫—â–æ —Ü–µ –≥–æ–ª–æ–≤–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è)

class CategoryCreate(CategoryBase):
    pass

class Category(CategoryBase):
    id: int
    # –î–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –º–æ–∂–µ–º–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —ñ–º'—è –±–∞—Ç—å–∫–∞, –∞–ª–µ –ø–æ–∫–∏ –∑–∞–ª–∏—à–∏–º–æ –±–∞–∑–æ–≤—ñ –ø–æ–ª—è
    class Config: from_attributes = True

# --- 2. UNITS (–û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—É) ---
class UnitBase(BaseModel):
    name: str
    symbol: str

# –ö–ª–∞—Å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (–±–µ–∑ ID)
class UnitCreate(UnitBase):
    pass

# –ö–ª–∞—Å –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –∑ –ë–î (–∑ ID)
class Unit(UnitBase):
    id: int
    class Config: from_attributes = True

# --- 3. INGREDIENTS ---
class IngredientBase(BaseModel):
    name: str
    cost_per_unit: float
    stock_quantity: float
    unit_id: Optional[int] = None

class IngredientCreate(IngredientBase):
    pass

class Ingredient(IngredientBase):
    id: int
    unit: Optional[Unit] = None
    class Config: from_attributes = True

# --- 4. MODIFIERS ---
class ModifierCreate(BaseModel):
    name: str
    price_change: float = 0.0
    ingredient_id: Optional[int] = None
    quantity: float = 0.0

class Modifier(ModifierCreate):
    id: int
    class Config: from_attributes = True

class ModifierGroupCreate(BaseModel):
    name: str
    is_required: bool = False
    modifiers: List[ModifierCreate] = []

class ModifierGroup(ModifierGroupCreate):
    id: int
    modifiers: List[Modifier] = []
    class Config: from_attributes = True

# --- 5. RECIPES ---
class RecipeItemCreate(BaseModel):
    ingredient_id: int
    quantity: float

class RecipeItem(RecipeItemCreate):
    ingredient_name: Optional[str] = None
    class Config: from_attributes = True

# --- 6. VARIANTS ---
class VariantCreate(BaseModel):
    name: str
    price: float
    sku: Optional[str] = None
    recipe: List[RecipeItemCreate] = []

class Variant(VariantCreate):
    id: int
    recipe: List[RecipeItem] = [] 
    class Config: from_attributes = True

# --- 7. PRODUCTS ---
class ProductBase(BaseModel):
    name: str
    description: Optional[str] = None
    category_id: Optional[int] = None
    has_variants: bool = False
    price: float = 0.0 

class ProductCreate(ProductBase):
    recipe: List[RecipeItemCreate] = []
    variants: List[VariantCreate] = []
    modifier_groups: List[ModifierGroupCreate] = []

class Product(ProductBase):
    id: int
    category: Optional[Category] = None
    recipe: List[RecipeItem] = []
    variants: List[Variant] = []
    modifier_groups: List[ModifierGroup] = []

    class Config:
        from_attributes = True

# --- 8. ORDERS & CUSTOMERS ---
class SoldItemModifier(BaseModel):
    modifier_id: int

class SoldItem(BaseModel):
    product_id: int
    variant_id: Optional[int] = None
    modifiers: List[SoldItemModifier] = []
    quantity: int

class OrderCreate(BaseModel):
    items: List[SoldItem]
    payment_method: str
    total_price: float
    customer_id: Optional[int] = None

class CustomerCreate(BaseModel):
    name: str
    phone: str
    email: Optional[str] = None
    notes: Optional[str] = None

class Customer(CustomerCreate):
    id: int
    class Config: from_attributes = True

class OrderItemRead(BaseModel):
    product_name: str
    quantity: int
    price_at_moment: float
    details: Optional[str] = None
    class Config: from_attributes = True

class OrderRead(BaseModel):
    id: int
    created_at: datetime
    total_price: float
    payment_method: str
    items: List[OrderItemRead]
    customer: Optional[Customer] = None
    class Config: from_attributes = True

========================================
FILE: product_service/database.py
========================================
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os

# –§–æ—Ä–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è: postgresql://user:password@hostname/dbname
# –¶—ñ –∑–º—ñ–Ω–Ω—ñ –º–∏ –ø—Ä–æ–ø–∏—Å–∞–ª–∏ –≤ docker-compose.yml —â–µ –Ω–∞ –ø–æ—á–∞—Ç–∫—É
USER = os.getenv("POSTGRES_USER", "user")
PASSWORD = os.getenv("POSTGRES_PASSWORD", "password")
DB_NAME = os.getenv("POSTGRES_DB", "products_db")
HOST = "pos_postgres" # –Ü–º'—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ –ë–î

SQLALCHEMY_DATABASE_URL = f"postgresql://{USER}:{PASSWORD}@{HOST}/{DB_NAME}"

# –°—Ç–≤–æ—Ä—é—î–º–æ –¥–≤–∏–≥—É–Ω (engine)
engine = create_engine(SQLALCHEMY_DATABASE_URL)

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—ñ–π (—á–µ—Ä–µ–∑ –Ω–µ—ó –º–∏ –±—É–¥–µ–º–æ —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# –ë–∞–∑–æ–≤–∏–π –∫–ª–∞—Å –¥–ª—è –≤—Å—ñ—Ö –Ω–∞—à–∏—Ö –º–∞–π–±—É—Ç–Ω—ñ—Ö —Ç–∞–±–ª–∏—Ü—å
Base = declarative_base()

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Å—ñ—ó (Dependency Injection)
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

========================================
FILE: product_service/main.py
========================================
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List
from sqlalchemy import or_
import models, schemas, database

app = FastAPI()

models.Base.metadata.create_all(bind=database.engine)

# --- ENDPOINTS –î–õ–Ø –ö–ê–¢–ï–ì–û–†–Ü–ô (–û–ù–û–í–õ–ï–ù–û) ---

@app.post("/categories/", response_model=schemas.Category)
def create_category(category: schemas.CategoryCreate, db: Session = Depends(database.get_db)):
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç
    db_category = db.query(models.Category).filter(models.Category.name == category.name).first()
    if db_category:
        raise HTTPException(status_code=400, detail="Category already exists")
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∫–æ–ª—å–æ—Ä—É —ñ –±–∞—Ç—å–∫–∞
    new_category = models.Category(
        name=category.name, 
        slug=category.slug,
        color=category.color,
        parent_id=category.parent_id
    )
    db.add(new_category)
    db.commit()
    db.refresh(new_category)
    return new_category

@app.get("/categories/", response_model=List[schemas.Category])
def read_categories(skip: int = 0, limit: int = 100, db: Session = Depends(database.get_db)):
    categories = db.query(models.Category).offset(skip).limit(limit).all()
    return categories

# --- –Ü–ù–®–Ü ENDPOINTS (–ó–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω, –∫–æ–¥ —Å–∫–æ—Ä–æ—á–µ–Ω–æ –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ) ---

@app.post("/units/", response_model=schemas.Unit)
def create_unit(unit: schemas.UnitCreate, db: Session = Depends(database.get_db)):
    db_unit = models.Unit(name=unit.name, symbol=unit.symbol)
    db.add(db_unit)
    db.commit()
    db.refresh(db_unit)
    return db_unit

@app.get("/units/", response_model=List[schemas.Unit])
def read_units(db: Session = Depends(database.get_db)):
    return db.query(models.Unit).all()

@app.post("/ingredients/", response_model=schemas.Ingredient)
def create_ingredient(ingredient: schemas.IngredientCreate, db: Session = Depends(database.get_db)):
    exists = db.query(models.Ingredient).filter(models.Ingredient.name == ingredient.name).first()
    if exists: raise HTTPException(status_code=400, detail="Ingredient already exists")
    new_item = models.Ingredient(name=ingredient.name, unit_id=ingredient.unit_id, cost_per_unit=ingredient.cost_per_unit, stock_quantity=ingredient.stock_quantity)
    db.add(new_item)
    db.commit()
    db.refresh(new_item)
    return new_item

@app.get("/ingredients/", response_model=List[schemas.Ingredient])
def read_ingredients(db: Session = Depends(database.get_db)):
    return db.query(models.Ingredient).all()

@app.put("/ingredients/{ingredient_id}", response_model=schemas.Ingredient)
def update_ingredient(ingredient_id: int, ingredient_data: schemas.IngredientCreate, db: Session = Depends(database.get_db)):
    db_ingredient = db.query(models.Ingredient).filter(models.Ingredient.id == ingredient_id).first()
    if not db_ingredient: raise HTTPException(status_code=404, detail="Ingredient not found")
    db_ingredient.name = ingredient_data.name
    db_ingredient.unit_id = ingredient_data.unit_id
    db_ingredient.cost_per_unit = ingredient_data.cost_per_unit
    db.commit()
    db.refresh(db_ingredient)
    return db_ingredient

@app.delete("/ingredients/{ingredient_id}")
def delete_ingredient(ingredient_id: int, db: Session = Depends(database.get_db)):
    db_ingredient = db.query(models.Ingredient).filter(models.Ingredient.id == ingredient_id).first()
    if not db_ingredient: raise HTTPException(status_code=404, detail="Ingredient not found")
    try:
        db.delete(db_ingredient)
        db.commit()
    except Exception:
        db.rollback()
        raise HTTPException(status_code=400, detail="–ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏: —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è")
    return {"status": "deleted"}

@app.post("/products/", response_model=schemas.Product)
def create_product(product: schemas.ProductCreate, db: Session = Depends(database.get_db)):
    db_product = models.Product(name=product.name, price=product.price, description=product.description, category_id=product.category_id, has_variants=product.has_variants)
    db.add(db_product)
    db.commit()
    db.refresh(db_product)
    
    if not product.has_variants and product.recipe:
        for item in product.recipe:
            db.add(models.ProductRecipe(product_id=db_product.id, ingredient_id=item.ingredient_id, quantity=item.quantity))
            
    if product.has_variants and product.variants:
        for v in product.variants:
            db_variant = models.ProductVariant(product_id=db_product.id, name=v.name, price=v.price, sku=v.sku)
            db.add(db_variant)
            db.commit()
            db.refresh(db_variant)
            for r_item in v.recipe:
                db.add(models.VariantRecipe(variant_id=db_variant.id, ingredient_id=r_item.ingredient_id, quantity=r_item.quantity))

    for group in product.modifier_groups:
        db_group = models.ProductModifierGroup(product_id=db_product.id, name=group.name, is_required=group.is_required)
        db.add(db_group)
        db.commit()
        db.refresh(db_group)
        for mod in group.modifiers:
            db.add(models.Modifier(group_id=db_group.id, name=mod.name, price_change=mod.price_change, ingredient_id=mod.ingredient_id, quantity=mod.quantity))
            
    db.commit()
    db.refresh(db_product)
    return db_product

@app.get("/products/", response_model=List[schemas.Product])
def read_products(db: Session = Depends(database.get_db)):
    return db.query(models.Product).all()

@app.put("/products/{product_id}", response_model=schemas.Product)
def update_product(product_id: int, product_data: schemas.ProductCreate, db: Session = Depends(database.get_db)):
    # 1. –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ç–æ–≤–∞—Ä
    db_product = db.query(models.Product).filter(models.Product.id == product_id).first()
    if not db_product:
        raise HTTPException(status_code=404, detail="Product not found")

    # 2. –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–∑–æ–≤—ñ –ø–æ–ª—è
    db_product.name = product_data.name
    db_product.description = product_data.description
    db_product.price = product_data.price
    db_product.category_id = product_data.category_id
    db_product.has_variants = product_data.has_variants

    # 3. –û—á–∏—â–∞—î–º–æ —Å—Ç–∞—Ä—ñ –∑–≤'—è–∑–∫–∏ (SQLAlchemy –≤–∏–¥–∞–ª–∏—Ç—å —ó—Ö –∑ –ë–î –∑–∞–≤–¥—è–∫–∏ cascade="all, delete-orphan")
    # –í–∞–∂–ª–∏–≤–æ: –º–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—Å–≤–æ—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Å–ø–∏—Å–∫–∏, ORM –∑—Ä–æ–±–∏—Ç—å —Ä–µ—à—Ç—É.
    db_product.recipe = []
    db_product.variants = []
    db_product.modifier_groups = []
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—á–∏—â–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º –Ω–æ–≤–∏—Ö (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤)
    db.flush()

    # 4. –î–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ –¥–∞–Ω—ñ (–õ–æ–≥—ñ–∫–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–∞ –¥–æ create_product)
    
    # 4.1 –ü—Ä–æ—Å—Ç–∏–π —Ä–µ—Ü–µ–ø—Ç
    if not product_data.has_variants and product_data.recipe:
        for item in product_data.recipe:
            db.add(models.ProductRecipe(
                product_id=db_product.id, 
                ingredient_id=item.ingredient_id, 
                quantity=item.quantity
            ))

    # 4.2 –í–∞—Ä—ñ–∞–Ω—Ç–∏
    if product_data.has_variants and product_data.variants:
        for v in product_data.variants:
            db_variant = models.ProductVariant(
                product_id=db_product.id, 
                name=v.name, 
                price=v.price, 
                sku=v.sku
            )
            db.add(db_variant)
            db.flush() # –©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ ID –≤–∞—Ä—ñ–∞–Ω—Ç—É
            
            for r_item in v.recipe:
                db.add(models.VariantRecipe(
                    variant_id=db_variant.id, 
                    ingredient_id=r_item.ingredient_id, 
                    quantity=r_item.quantity
                ))

    # 4.3 –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏
    for group in product_data.modifier_groups:
        db_group = models.ProductModifierGroup(
            product_id=db_product.id, 
            name=group.name, 
            is_required=group.is_required
        )
        db.add(db_group)
        db.flush()
        
        for mod in group.modifiers:
            db.add(models.Modifier(
                group_id=db_group.id, 
                name=mod.name, 
                price_change=mod.price_change, 
                ingredient_id=mod.ingredient_id, 
                quantity=mod.quantity
            ))

    db.commit()
    db.refresh(db_product)
    return db_product


@app.post("/customers/", response_model=schemas.Customer)
def create_customer(customer: schemas.CustomerCreate, db: Session = Depends(database.get_db)):
    exists = db.query(models.Customer).filter(models.Customer.phone == customer.phone).first()
    if exists: raise HTTPException(status_code=400, detail="–ö–ª—ñ—î–Ω—Ç –≤–∂–µ —ñ—Å–Ω—É—î")
    new_customer = models.Customer(**customer.dict())
    db.add(new_customer)
    db.commit()
    db.refresh(new_customer)
    return new_customer

@app.put("/customers/{customer_id}", response_model=schemas.Customer)
def update_customer(customer_id: int, customer_data: schemas.CustomerCreate, db: Session = Depends(database.get_db)):
    db_customer = db.query(models.Customer).filter(models.Customer.id == customer_id).first()
    if not db_customer: raise HTTPException(status_code=404, detail="Customer not found")
    db_customer.name = customer_data.name
    db_customer.phone = customer_data.phone
    db_customer.email = customer_data.email
    db_customer.notes = customer_data.notes
    try: db.commit(); db.refresh(db_customer)
    except: db.rollback(); raise HTTPException(status_code=400, detail="–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è")
    return db_customer

@app.get("/customers/search/", response_model=List[schemas.Customer])
def search_customers(q: str, db: Session = Depends(database.get_db)):
    search_term = f"%{q}%"
    return db.query(models.Customer).filter(or_(models.Customer.name.ilike(search_term), models.Customer.phone.ilike(search_term))).limit(10).all()

@app.get("/customers/", response_model=List[schemas.Customer])
def read_customers(skip: int = 0, limit: int = 50, db: Session = Depends(database.get_db)):
    return db.query(models.Customer).offset(skip).limit(limit).all()

@app.delete("/customers/{customer_id}")
def delete_customer(customer_id: int, db: Session = Depends(database.get_db)):
    customer = db.query(models.Customer).filter(models.Customer.id == customer_id).first()
    if not customer: raise HTTPException(status_code=404, detail="Customer not found")
    db.delete(customer)
    db.commit()
    return {"status": "deleted"}

@app.post("/orders/checkout/")
def create_order(order_data: schemas.OrderCreate, db: Session = Depends(database.get_db)):
    new_order = models.Order(total_price=order_data.total_price, payment_method=order_data.payment_method, customer_id=order_data.customer_id)
    db.add(new_order)
    db.commit()
    db.refresh(new_order)
    
    for item in order_data.items:
        product = db.query(models.Product).filter(models.Product.id == item.product_id).first()
        if not product: continue
        item_name = product.name
        price = product.price
        details_list = []
        
        if item.variant_id:
            variant = db.query(models.ProductVariant).filter(models.ProductVariant.id == item.variant_id).first()
            if variant:
                item_name = f"{product.name} ({variant.name})"
                price = variant.price
                details_list.append(f"–í–∞—Ä—ñ–∞–Ω—Ç: {variant.name}")
                for r in variant.variant_recipe:
                     if r.ingredient: r.ingredient.stock_quantity -= r.quantity * item.quantity; db.add(r.ingredient)
        else:
             for r in product.recipe:
                 if r.ingredient: r.ingredient.stock_quantity -= r.quantity * item.quantity; db.add(r.ingredient)

        for mod_item in item.modifiers:
            mod = db.query(models.Modifier).filter(models.Modifier.id == mod_item.modifier_id).first()
            if mod:
                details_list.append(mod.name)
                if mod.ingredient: mod.ingredient.stock_quantity -= mod.quantity * item.quantity; db.add(mod.ingredient)

        db.add(models.OrderItem(order_id=new_order.id, product_name=item_name, quantity=item.quantity, price_at_moment=price, details=", ".join(details_list)))
    db.commit()
    return {"status": "ok", "order_id": new_order.id}

@app.get("/orders/", response_model=List[schemas.OrderRead])
def get_orders(skip: int = 0, limit: int = 50, db: Session = Depends(database.get_db)):
    return db.query(models.Order).order_by(models.Order.created_at.desc()).offset(skip).limit(limit).all()

@app.get("/customers/{customer_id}/orders/", response_model=List[schemas.OrderRead])
def read_customer_orders(customer_id: int, db: Session = Depends(database.get_db)):
    return db.query(models.Order).filter(models.Order.customer_id == customer_id).order_by(models.Order.created_at.desc()).all()

========================================
FILE: product_service/models.py
========================================
from sqlalchemy import Column, Integer, String, Float, ForeignKey, DateTime, Boolean
from sqlalchemy.orm import relationship, backref
from database import Base
from datetime import datetime

# --- –ö–ê–¢–ï–ì–û–†–Ü–á (–û–ù–û–í–õ–ï–ù–û) ---
class Category(Base):
    __tablename__ = "categories"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, unique=True, index=True)
    slug = Column(String, unique=True)
    
    # –ù–û–í–Ü –ü–û–õ–Ø
    color = Column(String, default="#ffffff") # –ö–æ–ª—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (HEX)
    parent_id = Column(Integer, ForeignKey("categories.id"), nullable=True) # –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∞–º—É —Å–µ–±–µ
    
    # –ó–≤'—è–∑–æ–∫ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—á—ñ—Ä–Ω—ñ—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
    children = relationship("Category", 
                            backref=backref("parent", remote_side=[id]),
                            cascade="all, delete-orphan")

# --- –û–î–ò–ù–ò–¶–Ü –í–ò–ú–Ü–†–£ (–ë–µ–∑ –∑–º—ñ–Ω) ---
class Unit(Base):
    __tablename__ = "units"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, unique=True)
    symbol = Column(String, unique=True)

# --- –Ü–ù–ì–†–ï–î–Ü–Ñ–ù–¢–ò (–ë–µ–∑ –∑–º—ñ–Ω) ---
class Ingredient(Base):
    __tablename__ = "ingredients"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True, unique=True)
    unit_id = Column(Integer, ForeignKey("units.id"))
    unit = relationship("Unit")
    cost_per_unit = Column(Float, default=0.0)  # –Ø–∫—â–æ —Ü–µ –∑–º—ñ–Ω–∏—Ç—å—Å—è, –∑–º—ñ–Ω–∏—Ç—å—Å—è —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å –≤—Å—é–¥–∏
    stock_quantity = Column(Float, default=0.0)

# --- –ú–ê–ô–°–¢–ï–†-–¢–û–í–ê–† (PRODUCT) ---
class Product(Base):
    __tablename__ = "products"

    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, index=True)
    description = Column(String, nullable=True)
    category_id = Column(Integer, ForeignKey("categories.id"))
    category = relationship("Category")
    
    # –ü—Ä–∞–ø–æ—Ä–µ—Ü—å: —á–∏ –º–∞—î —Ü–µ–π —Ç–æ–≤–∞—Ä –≤–∞—Ä—ñ–∞–Ω—Ç–∏?
    has_variants = Column(Boolean, default=False)

    # –Ø–∫—â–æ —Ç–æ–≤–∞—Ä –ø—Ä–æ—Å—Ç–∏–π (–ø–µ—á–∏–≤–æ), —É –Ω—å–æ–≥–æ —î —Ü—ñ–Ω–∞. –Ø–∫—â–æ —Å–∫–ª–∞–¥–Ω–∏–π (–∫–∞–≤–∞) - —Ü—ñ–Ω–∞ 0 (–±–µ—Ä–µ—Ç—å—Å—è –∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤)
    price = Column(Float, default=0.0)

    # –ó–≤'—è–∑–∫–∏
    variants = relationship("ProductVariant", back_populates="product", cascade="all, delete-orphan")
    
    # –ü—Ä–æ—Å—Ç–∏–π —Ä–µ—Ü–µ–ø—Ç (–¥–ª—è —Ç–æ–≤–∞—Ä—ñ–≤ –±–µ–∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤, –Ω–∞–ø—Ä. –ö—Ä—É–∞—Å–∞–Ω)
    recipe = relationship("ProductRecipe", back_populates="product", cascade="all, delete-orphan")
    
    # –ì—Ä—É–ø–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ (–ü–æ–º–æ–ª, –°–∏—Ä–æ–ø–∏)
    modifier_groups = relationship("ProductModifierGroup", back_populates="product", cascade="all, delete-orphan")

# --- –í–ê–†–Ü–ê–ù–¢–ò (–ù–û–í–ï) ---
# –ù–∞–ø—Ä–∏–∫–ª–∞–¥: "Delicate 250g", "Delicate 1kg"
class ProductVariant(Base):
    __tablename__ = "product_variants"

    id = Column(Integer, primary_key=True, index=True)
    product_id = Column(Integer, ForeignKey("products.id"))
    
    name = Column(String) # "250 –≥" –∞–±–æ "–í–µ–ª–∏–∫–∏–π"
    price = Column(Float) # 250.00
    sku = Column(String, nullable=True) # –®—Ç—Ä–∏—Ö-–∫–æ–¥
    
    product = relationship("Product", back_populates="variants")
    
    # –†–µ—Ü–µ–ø—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è —Ü—å–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É (–Ω–∞–ø—Ä. 75–≥ –∫–∞–≤–∏ + 1 –ø–∞—á–∫–∞ 250–≥)
    variant_recipe = relationship("VariantRecipe", back_populates="variant", cascade="all, delete-orphan")

# --- –†–ï–¶–ï–ü–¢–ò ---

# 1. –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä—É
class ProductRecipe(Base):
    __tablename__ = "product_recipes"
    id = Column(Integer, primary_key=True, index=True)
    product_id = Column(Integer, ForeignKey("products.id"))
    ingredient_id = Column(Integer, ForeignKey("ingredients.id"))
    quantity = Column(Float)
    
    product = relationship("Product", back_populates="recipe")
    ingredient = relationship("Ingredient")

# 2. –î–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—É (–ù–û–í–ï)
class VariantRecipe(Base):
    __tablename__ = "variant_recipes"
    id = Column(Integer, primary_key=True, index=True)
    variant_id = Column(Integer, ForeignKey("product_variants.id"))
    ingredient_id = Column(Integer, ForeignKey("ingredients.id"))
    quantity = Column(Float) # –°–∫—ñ–ª—å–∫–∏ —Å–ø–∏—Å—É–≤–∞—Ç–∏
    
    variant = relationship("ProductVariant", back_populates="variant_recipe")
    ingredient = relationship("Ingredient")

# --- –ú–û–î–ò–§–Ü–ö–ê–¢–û–†–ò (–ù–û–í–ï) ---
# –ì—Ä—É–ø–∞: "–ü–æ–º–æ–ª", "–ú–æ–ª–æ–∫–æ"
class ProductModifierGroup(Base):
    __tablename__ = "product_modifier_groups"
    id = Column(Integer, primary_key=True)
    product_id = Column(Integer, ForeignKey("products.id"))
    name = Column(String) # "–û–±–µ—Ä—ñ—Ç—å –ø–æ–º–æ–ª"
    is_required = Column(Boolean, default=False) # –ß–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –æ–±–∏—Ä–∞—Ç–∏?
    
    product = relationship("Product", back_populates="modifier_groups")
    modifiers = relationship("Modifier", back_populates="group", cascade="all, delete-orphan")

# –û–ø—Ü—ñ—è: "–ü—ñ–¥ –ï—Å–ø—Ä–µ—Å–æ", "–ë–µ–∑–ª–∞–∫—Ç–æ–∑–Ω–µ –º–æ–ª–æ–∫–æ"
class Modifier(Base):
    __tablename__ = "modifiers"
    id = Column(Integer, primary_key=True)
    group_id = Column(Integer, ForeignKey("product_modifier_groups.id"))
    name = Column(String) 
    price_change = Column(Float, default=0.0) # +0 –≥—Ä–Ω –∞–±–æ +20 –≥—Ä–Ω
    
    # –Ø–∫—â–æ –≤–∏–±—ñ—Ä –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∞ —â–æ—Å—å —Å–ø–∏—Å—É—î (–Ω–∞–ø—Ä. –∫–æ—Ä–æ–±–∫—É)
    ingredient_id = Column(Integer, ForeignKey("ingredients.id"), nullable=True)
    quantity = Column(Float, default=0.0)

    group = relationship("ProductModifierGroup", back_populates="modifiers")
    ingredient = relationship("Ingredient")

# --- CRM —Ç–∞ ORDERS (–ë–µ–∑ –∑–º—ñ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, —Ç—ñ–ª—å–∫–∏ –ª–æ–≥—ñ–∫–∞) ---
class Customer(Base):
    __tablename__ = "customers"
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String)
    phone = Column(String, unique=True, index=True)
    email = Column(String, nullable=True)
    notes = Column(String, nullable=True)
    created_at = Column(DateTime, default=datetime.now)

class Order(Base):
    __tablename__ = "orders"
    id = Column(Integer, primary_key=True, index=True)
    created_at = Column(DateTime, default=datetime.now)
    total_price = Column(Float)
    payment_method = Column(String)
    customer_id = Column(Integer, ForeignKey("customers.id"), nullable=True)
    
    customer = relationship("Customer")
    items = relationship("OrderItem", back_populates="order", cascade="all, delete-orphan")

class OrderItem(Base):
    __tablename__ = "order_items"
    id = Column(Integer, primary_key=True, index=True)
    order_id = Column(Integer, ForeignKey("orders.id"))
    
    product_name = Column(String)
    quantity = Column(Integer)
    price_at_moment = Column(Float)
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–±—Ä–∞–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è —ñ—Å—Ç–æ—Ä—ñ—ó
    # –ù–∞–ø—Ä–∏–∫–ª–∞–¥: "–í–∞–≥–∞: 250–≥, –ü–æ–º–æ–ª: –ï—Å–ø—Ä–µ—Å–æ"
    details = Column(String, nullable=True) 

    order = relationship("Order", back_populates="items")

========================================
FILE: product_service/Dockerfile
========================================
FROM python:3.9-slim

WORKDIR /app

# –°–ø–æ—á–∞—Ç–∫—É –∫–æ–ø—ñ—é—î–º–æ –≤–∏–º–æ–≥–∏ —ñ —Å—Ç–∞–≤–∏–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (—â–æ–± –∫–µ—à—É–≤–∞–ª–æ—Å—å)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –¢–ï–ü–ï–† –ö–û–ü–Ü–Æ–Ñ–ú–û –í–°–ï (–≤–∫–ª—é—á–∞—é—á–∏ models.py, schemas.py, database.py)
COPY . .

# –ó–∞–ø—É—Å–∫–∞—î–º–æ
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
